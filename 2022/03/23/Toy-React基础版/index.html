<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/Frog_32px_1177822_easyicon.net.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/Frog_32px_1177822_easyicon.net.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/Frog_16px_1177822_easyicon.net.ico">
  <link rel="mask-icon" href="/images/Frog_32px_1177822_easyicon.net.ico" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"hxy1997.xyz","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":"valine","storage":true,"lazyload":true,"nav":null,"activeClass":"valine"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"è¾“å…¥å…³é”®å­—","hits_empty":"æ²¡æœ‰æ‰¾åˆ°ä¸ã€Œ${query}ã€ç›¸å…³æœç´¢","hits_stats":"${hits} æ¡ç›¸å…³è®°å½•ï¼Œå…±è€—æ—¶ ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.json"};
  </script>

  <meta name="description" content="è¿™ä¸ªToy-React æ˜¯æˆ‘é€‰æ‹©åœ¨å…¥èŒå‰çš„ç»ƒæ‰‹é¡¹ç›®ï¼Œæ¯”è¾ƒåŸºç¡€ï¼Œåç»­äºŸå¾…å®Œå–„ï¼ˆä¸»è¦æƒ³ç”¨ä¸ŠTypescriptï¼‰ã€‚ä¸»è¦ç›®çš„æ˜¯å¸Œæœ›å®ƒå¯ä»¥ä½œä¸ºä¸€æŠŠå¼€å¯Reactæºç å¤§é—¨çš„é’¥åŒ™ã€‚è¿›ä¸€æ­¥å­¦ä¹ Reactçš„åŸç†çŸ¥è¯†ï¼Œæ›´åŠ æ·±åˆ»ç†è§£Reactã€‚">
<meta property="og:type" content="article">
<meta property="og:title" content="Toy-ReactåŸºç¡€ç‰ˆ">
<meta property="og:url" content="https://hxy1997.xyz/2022/03/23/Toy-React%E5%9F%BA%E7%A1%80%E7%89%88/index.html">
<meta property="og:site_name" content="hxyçš„åšå®¢">
<meta property="og:description" content="è¿™ä¸ªToy-React æ˜¯æˆ‘é€‰æ‹©åœ¨å…¥èŒå‰çš„ç»ƒæ‰‹é¡¹ç›®ï¼Œæ¯”è¾ƒåŸºç¡€ï¼Œåç»­äºŸå¾…å®Œå–„ï¼ˆä¸»è¦æƒ³ç”¨ä¸ŠTypescriptï¼‰ã€‚ä¸»è¦ç›®çš„æ˜¯å¸Œæœ›å®ƒå¯ä»¥ä½œä¸ºä¸€æŠŠå¼€å¯Reactæºç å¤§é—¨çš„é’¥åŒ™ã€‚è¿›ä¸€æ­¥å­¦ä¹ Reactçš„åŸç†çŸ¥è¯†ï¼Œæ›´åŠ æ·±åˆ»ç†è§£Reactã€‚">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/huxingyi1997/my_img/img/20220407083210.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/huxingyi1997/my_img/img/20220406223503.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/huxingyi1997/my_img/img/20220407132424.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/huxingyi1997/my_img/img/20220407133433.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/huxingyi1997/my_img/img/20220407133532.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/huxingyi1997/my_img/img/20220407173725.gif">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/huxingyi1997/my_img/img/20220407174623.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/huxingyi1997/my_img/img/20220407175146.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/huxingyi1997/my_img/img/20220407180207.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/huxingyi1997/my_img/img/20220407180613.gif">
<meta property="article:published_time" content="2022-03-23T12:18:33.000Z">
<meta property="article:modified_time" content="2022-04-07T10:09:40.117Z">
<meta property="article:author" content="hxy">
<meta property="article:tag" content="React">
<meta property="article:tag" content="å‰ç«¯">
<meta property="article:tag" content="è½®å­">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/huxingyi1997/my_img/img/20220407083210.png">

<link rel="canonical" href="https://hxy1997.xyz/2022/03/23/Toy-React%E5%9F%BA%E7%A1%80%E7%89%88/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Toy-ReactåŸºç¡€ç‰ˆ | hxyçš„åšå®¢</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="hxyçš„åšå®¢" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">hxyçš„åšå®¢</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Mia san Mia!</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>å…³äº</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="æœç´¢..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/huxingyi1997" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://hxy1997.xyz/2022/03/23/Toy-React%E5%9F%BA%E7%A1%80%E7%89%88/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/Robben.gif">
      <meta itemprop="name" content="hxy">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="hxyçš„åšå®¢">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Toy-ReactåŸºç¡€ç‰ˆ
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2022-03-23 20:18:33" itemprop="dateCreated datePublished" datetime="2022-03-23T20:18:33+08:00">2022-03-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2022-04-07 18:09:40" itemprop="dateModified" datetime="2022-04-07T18:09:40+08:00">2022-04-07</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">webå‰ç«¯</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="çƒ­åº¦" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">çƒ­åº¦ï¼š</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valineï¼š</span>
    
    <a title="valine" href="/2022/03/23/Toy-React%E5%9F%BA%E7%A1%80%E7%89%88/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/03/23/Toy-React%E5%9F%BA%E7%A1%80%E7%89%88/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>è¿™ä¸ªToy-React æ˜¯æˆ‘é€‰æ‹©åœ¨å…¥èŒå‰çš„ç»ƒæ‰‹é¡¹ç›®ï¼Œæ¯”è¾ƒåŸºç¡€ï¼Œåç»­äºŸå¾…å®Œå–„ï¼ˆä¸»è¦æƒ³ç”¨ä¸ŠTypescriptï¼‰ã€‚ä¸»è¦ç›®çš„æ˜¯å¸Œæœ›å®ƒå¯ä»¥ä½œä¸ºä¸€æŠŠå¼€å¯Reactæºç å¤§é—¨çš„é’¥åŒ™ã€‚è¿›ä¸€æ­¥å­¦ä¹ Reactçš„åŸç†çŸ¥è¯†ï¼Œæ›´åŠ æ·±åˆ»ç†è§£Reactã€‚</p>
<span id="more"></span>

<h1 id="Reactæ¡†æ¶èƒŒåçš„æ ¸å¿ƒæœºç†"><a href="#Reactæ¡†æ¶èƒŒåçš„æ ¸å¿ƒæœºç†" class="headerlink" title="Reactæ¡†æ¶èƒŒåçš„æ ¸å¿ƒæœºç†"></a>Reactæ¡†æ¶èƒŒåçš„æ ¸å¿ƒæœºç†</h1><h2 id="1-é¡¹ç›®åˆå§‹åŒ–"><a href="#1-é¡¹ç›®åˆå§‹åŒ–" class="headerlink" title="1. é¡¹ç›®åˆå§‹åŒ–"></a>1. é¡¹ç›®åˆå§‹åŒ–</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// 1.åˆ›å»ºtoy-reactæ–‡ä»¶å¤¹</span><br><span class="line">mkdir toy-react</span><br><span class="line"></span><br><span class="line">// 2.è¿›å…¥toy-reactæ–‡ä»¶å¤¹</span><br><span class="line"><span class="built_in">cd</span> toy-react</span><br><span class="line"></span><br><span class="line">// 3.åˆ›å»ºé¡¹ç›®</span><br><span class="line">npm init -y</span><br></pre></td></tr></table></figure>

<h2 id="2-é…ç½®webpackç¯å¢ƒ"><a href="#2-é…ç½®webpackç¯å¢ƒ" class="headerlink" title="2. é…ç½®webpackç¯å¢ƒ"></a>2. é…ç½®webpackç¯å¢ƒ</h2><h3 id="1-å®‰è£…webpack"><a href="#1-å®‰è£…webpack" class="headerlink" title="1.å®‰è£…webpack"></a>1.å®‰è£…webpack</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install webpack webpack-cli --save-dev</span><br></pre></td></tr></table></figure>

<h3 id="2-é…ç½®webpack"><a href="#2-é…ç½®webpack" class="headerlink" title="2.é…ç½®webpack"></a>2.é…ç½®webpack</h3><p>å»ºç«‹ <code>webpack.config.js </code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// nodeçš„æ ‡å‡†export</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">	<span class="comment">// å…¥å£æ–‡ä»¶</span></span><br><span class="line">	entry: &#123;</span><br><span class="line">		main: <span class="string">&#x27;./main.js&#x27;</span></span><br><span class="line">	&#125;</span><br><span class="line">    <span class="comment">// å¢åŠ buildåæ–‡ä»¶å¯è¯»æ€§ï¼Œä¸å‹ç¼©æ‰“åŒ…åæ–‡ä»¶</span></span><br><span class="line">    mode: <span class="string">&quot;development&quot;</span>,</span><br><span class="line">    optimization: &#123;</span><br><span class="line">    	minimize: <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-é…ç½®babel"><a href="#3-é…ç½®babel" class="headerlink" title="3.é…ç½®babel"></a>3.é…ç½®babel</h3><p>å®‰è£…babel</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// babel-loader webpackå°†babelæ‰“åŒ…åˆ°main.js</span><br><span class="line">// @babel/core  babelæ ¸å¿ƒ</span><br><span class="line">// @babel/preset-env å°†babelè½¬ä¹‰åˆ°æ‰€éœ€jsç‰ˆæœ¬</span><br><span class="line">// https://www.babeljs.cn/docs/babel-preset-env</span><br><span class="line">npm install babel-loader @babel/core @babel/preset-env --save-dev</span><br></pre></td></tr></table></figure>

<p>åœ¨ <code>webpack.config.js </code>ä¸­é…ç½® <code>babel-loader </code>ï¼Œ <code>babel-loader</code> å°†esé«˜çº§è¯­æ³•è½¬åŒ–ä¸ºæµè§ˆå™¨èƒ½å¤Ÿè¯»æ‡‚çš„è¯­æ³•ï¼Œ <code>@babel/preset-env </code>ä½œä¸ºé¢„è½¬è¯‘æ’ä»¶</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">// modules æ‰“åŒ…è§„åˆ™</span></span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">    	rules: [</span><br><span class="line">        	<span class="comment">// js æ–‡ä»¶éœ€ç»è¿‡babel</span></span><br><span class="line">        	&#123;</span><br><span class="line">            	test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">                use: &#123;</span><br><span class="line">                	loader: <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">                    <span class="comment">// é…ç½®babel-loader</span></span><br><span class="line">                    options: &#123;</span><br><span class="line">                    	presets: [<span class="string">&#x27;@babel/preset-env&#x27;</span>]</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®‰è£…babelçš„jsxæ’ä»¶ï¼Œ<code>@babel/plugin-transform-react-jsx</code> è§£æjsxè¯­æ³•ç³–</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install @babel/plugin-transform-react-jsx --save-dev</span><br></pre></td></tr></table></figure>

<p>é…ç½®babelçš„jsxæ’ä»¶</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">// modules æ‰“åŒ…è§„åˆ™</span></span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">    	rules: [</span><br><span class="line">        	<span class="comment">// js æ–‡ä»¶éœ€ç»è¿‡babel</span></span><br><span class="line">        	&#123;</span><br><span class="line">            	test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">                use: &#123;</span><br><span class="line">                	loader: <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">                    <span class="comment">// é…ç½®babel-loader</span></span><br><span class="line">                    options: &#123;</span><br><span class="line">                    	presets: [<span class="string">&#x27;@babel/preset-env&#x27;</span>],</span><br><span class="line">                        plugins: [<span class="string">&#x27;@babel/plugin-transform-react-jsx&#x27;</span>]</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å› ä¸ºæ˜¯æ‰‹å†™çš„react<del>å€ŸåŠ©react-jsxçš„å¡‘æ–™react</del>ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é‡æ–°é…ç½®<code>@babel/plugin-transform-react-jsx</code>ï¼Œè®©å®ƒçœ‹èµ·æ¥æ²¡æœ‰é‚£ä¹ˆreact</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">    	rules: [</span><br><span class="line">        	&#123;</span><br><span class="line">            	test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">                use: &#123;</span><br><span class="line">                	loader: <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">                    <span class="comment">// é…ç½®babel-loader</span></span><br><span class="line">                    options: &#123;</span><br><span class="line">                    	presets: [<span class="string">&#x27;@babel/preset-env&#x27;</span>],</span><br><span class="line">                        <span class="comment">// è¿™æ ·æ‰“åŒ…åçš„â€˜React.createElementå°±ä¼šå˜æˆâ€˜ToyReact.createElementâ€™</span></span><br><span class="line">                        plugins: [[<span class="string">&#x27;@babel/plugin-transform-react-jsx&#x27;</span>, &#123;<span class="attr">pragma</span>: <span class="string">&#x27;ToyReact.createElement&#x27;</span>&#125;]]</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-å®ç°toyReact"><a href="#3-å®ç°toyReact" class="headerlink" title="3. å®ç°toyReact"></a>3. å®ç°toyReact</h2><p>ä¸ºäº†æ›´åŠ ç›´è§‚çš„å±•ç¤ºæ•ˆæœ, æˆ‘ä»¬å¯ä»¥å°†æ‰“åŒ…åçš„scriptæ–‡ä»¶, å¼•å…¥åˆ°<code>dist/main.html</code>ä¸­ã€‚</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;main.js&quot;</span> &gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨<code>@babel/plugin-transform-react-jsx</code>æ‰“åŒ…ä¹‹åjsx(<code>main.js</code>)æ˜¯è¿™ä¸ªæ ·å­</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ‰“åŒ…å‰çš„jsx</span></span><br><span class="line"><span class="keyword">let</span> a = <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;a&quot;</span> <span class="attr">class</span>=<span class="string">&quot;c&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰“åŒ…åçš„jsx</span></span><br><span class="line"><span class="keyword">var</span> a = React.createElement(<span class="string">&quot;div&quot;</span>, </span><br><span class="line">&#123;<span class="attr">id</span>: <span class="string">&quot;a&quot;</span>, <span class="string">&quot;class&quot;</span>: <span class="string">&quot;c&quot;</span>&#125;, </span><br><span class="line">React.createElement(<span class="string">&quot;div&quot;</span>, <span class="literal">null</span>), </span><br><span class="line">React.createElement(<span class="string">&quot;div&quot;</span>, <span class="literal">null</span>))</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œ<code>React.createElement()</code>ä¼šä¼ å…¥ä¸‰ä¸ªå‚æ•°<code>tagName</code>,<code>tag</code>çš„å±æ€§åˆ—è¡¨ï¼Œ<code>tag</code>çš„å­å…ƒç´ </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">React.createElement(tagName, attributes, ...children)</span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å®ç°æœ€ç®€å•çš„<code>createElement</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">ToyReact</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> createElement (tagName, attributes, ...children) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">document</span>.createElement(tagName)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ä¸ºæˆ‘ä»¬çš„<code>createElement</code>å¢åŠ å±æ€§å’Œå­èŠ‚ç‚¹çš„é…ç½®</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">ToyReact</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> createElement (tagName, attributes, ...children) &#123;</span><br><span class="line">        <span class="keyword">let</span> e = <span class="built_in">document</span>.createElement(tagName)</span><br><span class="line">        <span class="comment">// å¢åŠ å±æ€§</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">in</span> attributes) &#123;</span><br><span class="line">            e.setAttribute(i, attributes[i])</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å¢åŠ å­èŠ‚ç‚¹</span></span><br><span class="line">        <span class="comment">// æ‰©å±•è¿ç®—ç¬¦å°†childrenåŒ…è£…ä¸ºä¸€ä¸ªæ•°ç»„</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> child <span class="keyword">of</span> children) &#123;</span><br><span class="line">            e.appendChild(child)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> e</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬çš„<code>createElement</code>å·²ç»å¯ä»¥å®ç°ä½¿ç”¨ï¼Œä½†æ˜¯å°šæœªè€ƒè™‘<strong>æ–‡æœ¬èŠ‚ç‚¹</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">ToyReact</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> createElement (tagName, attributes, ...children) &#123;</span><br><span class="line">        <span class="keyword">let</span> e = <span class="built_in">document</span>.createElement(tagName)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">in</span> attributes) &#123;</span><br><span class="line">            e.setAttribute(i, attributes[i])</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> child <span class="keyword">of</span> children) &#123;</span><br><span class="line">            <span class="comment">// å°†childåˆ›å»ºä¸ºæ–‡æœ¬èŠ‚ç‚¹</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">typeof</span> child === <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">                child = <span class="built_in">document</span>.createTextNode(child)</span><br><span class="line">            &#125;</span><br><span class="line">            e.appendChild(child)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> e</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç›®å‰ï¼Œæˆ‘ä»¬çš„<code>createElement</code>å¯ä»¥æ”¯æŒåŸºç¡€çš„domæ“ä½œï¼Œæ˜¯åˆæ ¼çš„è¯­æ³•ç³–ğŸ¬äº†ã€‚</p>
<p>ä½†é—®é¢˜ä¾æ—§å­˜åœ¨ï¼šåœ¨reactçš„jsxä¸­ï¼Œå°å†™çš„tagNameå¯¹åº”ç”ŸæˆåŸç”Ÿdomå¯¹è±¡ï¼Œè€Œå¤§å†™çš„tagNameåˆ™å¯¹åº”<strong>è‡ªå®šä¹‰ç»„ä»¶</strong>ã€‚<code>tagName</code>å‚æ•°æ”¯æŒä¼ å…¥çš„ï¼Œä¸ä»…ä»…æ˜¯å­—ç¬¦ä¸²ï¼Œè¿˜æ”¯æŒ<strong>classç»„ä»¶</strong>ä»¥åŠ<strong>å‡½æ•°ç»„ä»¶</strong></p>
<p>æ•…è€Œï¼Œ<code>tagName</code>å…¶å®æ˜¯<code>tagType</code>å‚æ•°ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®<code>tagType</code>ç”Ÿæˆä¸åŒçš„domå¯¹è±¡ ï¼ˆç›®å‰åªæ”¯æŒclassç»„ä»¶ï¼‰</p>
<h3 id="3-1-æ™®é€šèŠ‚ç‚¹çš„wrapperå®ç°"><a href="#3-1-æ™®é€šèŠ‚ç‚¹çš„wrapperå®ç°" class="headerlink" title="3.1 æ™®é€šèŠ‚ç‚¹çš„wrapperå®ç°"></a>3.1 æ™®é€šèŠ‚ç‚¹çš„wrapperå®ç°</h3><p>æ–°å»ºElementWrapperç±»,å¹¶ä¸”æ–°å¢ <code>åˆ›å»ºå®ä½“DOM</code>æ–¹æ³• ä»¥åŠ <code>setAttribute</code>å’Œ <code>appendChild</code> æ–¹æ³•ã€‚</p>
<p>appendChildæ–¹æ³•ä¸­<code>component</code> éƒ½æ˜¯ç»è¿‡ <code>ElementWrapper</code> æˆ–è€…</p>
<p><code>TextWrapper</code> å®ä¾‹åŒ–åçš„å€¼ã€‚ <code>component.root</code> æŒ‡ä»£çš„å³æ˜¯å…ƒç´ èŠ‚ç‚¹æˆ–è€…æ–‡æœ¬èŠ‚ç‚¹</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ElementWrapper</span> </span>&#123;</span><br><span class="line">	<span class="title">constructor</span> (<span class="params">type</span>) &#123;</span><br><span class="line">    	<span class="comment">// åˆ›å»ºæ ¹å…ƒç´ </span></span><br><span class="line">    	<span class="built_in">this</span>.root = <span class="built_in">document</span>.createElement(type)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// é…ç½®å±æ€§</span></span><br><span class="line">    setAttribute (name, value) &#123;</span><br><span class="line">    	<span class="built_in">this</span>.root.setAttribute(name, value)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ·»åŠ å­å…ƒç´ </span></span><br><span class="line">    <span class="comment">// æ·»åŠ çš„æ˜¯componentï¼Œæ‰€ä»¥è¦å–å‡ºä¼ å…¥çš„componentçš„root</span></span><br><span class="line">    appendChild (component) &#123;</span><br><span class="line">    	<span class="built_in">this</span>.root.appendChild(component.root)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ–°å»ºTextNodeWrapperç±», å¹¶ä¸”åªéœ€è¦åˆ›å»ºä¸€ä¸ªæ–‡æœ¬èŠ‚ç‚¹å³å¯ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ–‡æœ¬èŠ‚ç‚¹ä¸éœ€è¦è®¾ç½®å±æ€§åŠæ·»åŠ å­å…ƒç´ </span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TextWrapper</span> </span>&#123;</span><br><span class="line">	<span class="title">constructor</span> (<span class="params">content</span>) &#123;</span><br><span class="line">    	<span class="built_in">this</span>.root = <span class="built_in">document</span>.createTextNode(content)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-å®ç°Componentç±»"><a href="#3-2-å®ç°Componentç±»" class="headerlink" title="3.2 å®ç°Componentç±»"></a>3.2 å®ç°Componentç±»</h3><p>è‡ªå®šä¹‰ç»„ä»¶éœ€è¦ç»§æ‰¿Componentç±»ï¼Œé™å®šå®ƒçš„é»˜è®¤è¡Œä¸º</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">	render () &#123;</span><br><span class="line">    	<span class="keyword">return</span> &lt;div&gt;</span><br><span class="line">          &lt;h1&gt;myComponent&lt;/h1&gt;</span><br><span class="line">          &#123;<span class="built_in">this</span>.children&#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆæ¨¡ä»¿reactçš„å®ç°ï¼Œæˆ‘ä»¬çš„Componentç±»å¤§æ¦‚æ˜¯è¿™ä¸ªæ ·å­ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">	<span class="title">constructor</span> (<span class="params"></span>) &#123;</span><br><span class="line">    	<span class="comment">// ä¸éœ€è¦æœ‰ä»€ä¹ˆè¡Œä¸º</span></span><br><span class="line">        <span class="comment">// å–åˆ°props</span></span><br><span class="line">        <span class="built_in">this</span>.props = <span class="built_in">Object</span>.create(<span class="literal">null</span>)</span><br><span class="line">        <span class="built_in">this</span>.children = []</span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–root</span></span><br><span class="line">        <span class="built_in">this</span>._root = <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æŠŠComponentçš„å±æ€§å­˜èµ·æ¥</span></span><br><span class="line">    setAttribute (name, value) &#123;</span><br><span class="line">    	<span class="built_in">this</span>.props[name] = value</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ·»åŠ å­å…ƒç´ </span></span><br><span class="line">    appendChild (component) &#123;</span><br><span class="line">    	<span class="built_in">this</span>.children.push(component)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è®¾ç½® root çš„getter</span></span><br><span class="line">    get root () &#123;</span><br><span class="line">    	<span class="keyword">if</span> (!<span class="built_in">this</span>._root) &#123;</span><br><span class="line">        <span class="comment">// æ¸²æŸ“ç»„ä»¶ï¼Œè°ƒç”¨ç»„ä»¶çš„renderæ–¹æ³•</span></span><br><span class="line">        <span class="comment">// å¦‚æœrenderä¹‹åæ˜¯componentï¼Œåˆ™ä¼šé€’å½’è°ƒç”¨ï¼Œç›´è‡³å…¶æˆä¸ºelementWrapperæˆ–è€…textWrapper</span></span><br><span class="line">        	<span class="built_in">this</span>._root = <span class="built_in">this</span>.render().root</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>._root</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå¯èƒ½ä¼šæœ‰ç–‘é—®, ä¸ºä»€ä¹ˆéœ€è¦æ–°å¢ä¸€ä¸ªé¢å¤–çš„ç±»ã€‚</p>
<p>å½“babelè§£æåˆ°<code>TestComponent</code>çš„æ—¶å€™, æˆ‘ä»¬ç›´æ¥å®ä¾‹åŒ–å®ƒ, å¹¶ä¸”ç»™å®ä¾‹åŒ–åçš„å€¼ <code>setAttribute</code>å±æ€§ä»¥åŠ<code> appendChild</code> å­èŠ‚ç‚¹ã€‚ æˆ‘ä»¬å½“ç„¶ä¸èƒ½åœ¨main.jsä¸­å†™è¿™äº›æ–¹æ³•çš„å…·ä½“å®ç°ã€‚å› æ­¤æˆ‘ä»¬è®©TestComponentå»<code>ç»§æ‰¿</code> Component, è®©Componentç±»å»å®ç°è¿™ä¸¤ä¸ªæ–¹æ³•ã€‚</p>
<h3 id="3-3-å®ç°render"><a href="#3-3-å®ç°render" class="headerlink" title="3.3 å®ç°render"></a>3.3 å®ç°render</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">ToyReact</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> render (component, parentElement) &#123;</span><br><span class="line">        <span class="comment">// parentElementä¸ºå®é™…dom</span></span><br><span class="line">        parentElement.appendChild(component.root)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-4-é‡æ„createElement"><a href="#3-4-é‡æ„createElement" class="headerlink" title="3.4 é‡æ„createElement"></a>3.4 é‡æ„<code>createElement</code></h3><p>åˆ¤æ–­elementçš„ç±»å‹, å¦‚æœæ˜¯å…ƒç´ æ ‡ç­¾çš„å­—ç¬¦ä¸²ç±»å‹, é‚£ä¹ˆå°±é€šè¿‡ElementWrapperåˆ›å»ºå®DOM, å¦åˆ™å°±ç›´æ¥å®ä¾‹åŒ–æœ¬èº«è¿”å›å…¶renderçš„jsx, è¿›è¡Œé‡æ–°è°ƒç”¨createElementæ„å»ºå…ƒç´ ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">ToyReact</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> createElement (tagType, attributes, ...children) &#123;</span><br><span class="line">        <span class="keyword">let</span> element</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> tagType === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœæ˜¯å°å†™çš„tagNameï¼Œåˆ™ç”ŸæˆElementWrapperå¯¹è±¡</span></span><br><span class="line">            element = <span class="keyword">new</span> ElementWrapper(tagType)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœæ˜¯ç»„ä»¶ï¼Œåˆ™ç”Ÿæˆå¯¹åº”çš„ç»„ä»¶å¯¹è±¡</span></span><br><span class="line">            element = <span class="keyword">new</span> tagType</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å¢åŠ å±æ€§</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> name <span class="keyword">in</span> attributes) &#123;</span><br><span class="line">            <span class="comment">// è°ƒç”¨å…ƒç´ çš„setAttributeæ–¹æ³•</span></span><br><span class="line">            element.setAttribute(name, attributes[name])</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å¢åŠ å­èŠ‚ç‚¹</span></span><br><span class="line">        <span class="comment">// æ‰©å±•è¿ç®—ç¬¦å°†childrenåŒ…è£…ä¸ºä¸€ä¸ªæ•°ç»„</span></span><br><span class="line">        <span class="keyword">let</span> insertChildren = <span class="function">(<span class="params">children</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">let</span> child <span class="keyword">of</span> children) &#123;</span><br><span class="line">                <span class="comment">// å¦‚æœchildä¸ºnullï¼Œä¸åšä»»ä½•å¤„ç†</span></span><br><span class="line">                <span class="keyword">if</span> (child === <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// å°†childåˆ›å»ºä¸ºæ–‡æœ¬èŠ‚ç‚¹ï¼Œå¦‚æœchildæ˜¯æ–‡æœ¬èŠ‚ç‚¹</span></span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">typeof</span> child === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">                    child = <span class="keyword">new</span> TextWrapper(child)</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// å½“childæ˜¯æ•°ç»„çš„æ—¶å€™ï¼Œå³componentä¸­çš„childrenï¼Œéœ€è¦å±•å¼€child</span></span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">typeof</span> child === <span class="string">&#x27;object&#x27;</span> &amp;&amp; child <span class="keyword">instanceof</span> <span class="built_in">Array</span>) &#123;</span><br><span class="line">                    <span class="comment">// é€’å½’è°ƒç”¨</span></span><br><span class="line">                    insertChildren(child)</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// è°ƒç”¨å…ƒç´ çš„appendChildæ–¹æ³•</span></span><br><span class="line">                    element.appendChild(child)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        insertChildren(children)</span><br><span class="line">        <span class="keyword">return</span> element</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç®€å•çš„é€’å½’å‡½æ•°å»å¤„ç†childæ˜¯æ•°ç»„çš„æƒ…å†µã€‚ç°åœ¨æˆ‘ä»¬çš„é¡µé¢å¯ä»¥æ­£å¸¸çš„æ˜¾ç¤ºDOMç»“æ„, å¹¶ä¸”æ‹¥æœ‰propsçš„èƒ½åŠ›ã€‚ </p>
<h3 id="3-5-main-jsæ–‡ä»¶"><a href="#3-5-main-jsæ–‡ä»¶" class="headerlink" title="3.5 main.jsæ–‡ä»¶"></a>3.5 main.jsæ–‡ä»¶</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Component, ToyReact &#125; <span class="keyword">from</span> <span class="string">&#x27;./toy-react.js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    render () &#123;</span><br><span class="line">        <span class="keyword">return</span> &lt;div&gt;</span><br><span class="line">            &lt;h1&gt;myComponent&lt;/h1&gt;</span><br><span class="line">            &#123;<span class="built_in">this</span>.children&#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ToyReact.render(<span class="xml"><span class="tag">&lt;<span class="name">MyComponent</span> <span class="attr">id</span>=<span class="string">&quot;a&quot;</span> <span class="attr">class</span>=<span class="string">&quot;c&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>ssss<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">MyComponent</span>&gt;</span></span>, <span class="built_in">document</span>.body)</span><br></pre></td></tr></table></figure>

<h2 id="4-ä¸€äº›ç¬”è®°"><a href="#4-ä¸€äº›ç¬”è®°" class="headerlink" title="4. ä¸€äº›ç¬”è®°"></a>4. ä¸€äº›ç¬”è®°</h2><p>é€šè¿‡<a target="_blank" rel="noopener" href="https://www.babeljs.cn/docs/babel-preset-env">é˜…è¯»Babelå®˜ç½‘</a>ï¼Œäº†è§£åˆ°@babel/plugin-transform-react-jsxæ’ä»¶æœ‰ä¸¤ç§ç¼–è¯‘jsxçš„æ–¹å¼ï¼š</p>
<ul>
<li>è¿è¡Œæ—¶ç¼–è¯‘æ–¹å¼ï¼ˆReact Automatic Runtimeï¼‰</li>
<li>æ‰‹åŠ¨å¼•å…¥React.createElementçš„æ–¹å¼ï¼ˆReact Classic Runtimeï¼‰</li>
</ul>
<p>è¿™è§£é‡Šäº†å›°æ‰°æˆ‘çš„ä¸¤ä¸ªé—®é¢˜ï¼š</p>
<blockquote>
<p>1ã€ä¸ºä»€ä¹ˆå®šä¹‰äº†createElementæ–¹æ³•å´æ²¡æœ‰è°ƒç”¨ï¼Ÿ</p>
<p>å› ä¸ºbabel jsxè½¬æ¢æ’ä»¶æ˜¯â€œè¿è¡Œæ—¶ç¼–è¯‘â€ä¸”pagramå‚æ•°ä¸ºcreateElementï¼Œæ‰€ä»¥ä»£ç ç¼–è¯‘æ—¶ä¼šè‡ªåŠ¨è§£æjsxå¹¶è°ƒç”¨createElementæ–¹æ³•ã€‚</p>
</blockquote>
<blockquote>
<p>2ã€ä¸ºä»€ä¹ˆrenderæ–¹æ³•é‡Œçˆ¶èŠ‚ç‚¹è¦æ¥æ”¶ä¸€ä¸ªcomponent.rootä½œä¸ºå‚æ•°è€Œä¸æ˜¯componentï¼Ÿ</p>
<p>åŒæ ·æ˜¯ç”±äºbabel jsxæ’ä»¶çš„â€œè¿è¡Œæ—¶â€ç¼–è¯‘ï¼Œè°ƒç”¨createElementæ–¹æ³•åä¼šå®ä¾‹åŒ–ä¸€ä¸ªComponentå¯¹è±¡ï¼Œè¯¥å¯¹è±¡åˆå§‹rootä¸ºnullï¼Œä»è€Œä¼šè°ƒç”¨renderæ–¹æ³•ï¼ˆå³MyComponentä¸­çš„renderæ–¹æ³•ï¼‰ï¼Œè¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªJSXï¼Œä»è€Œåˆä¼šè°ƒç”¨createElementæ–¹æ³•ï¼Œæ­¤æ—¶æ˜¯ä¸€ä¸ªçœŸå®çš„DOMèŠ‚ç‚¹ï¼Œæ‰€ä»¥ä¼šåˆå§‹åŒ–ä¸€ä¸ªElementWrapperå¯¹è±¡ï¼Œè¯¥å¯¹è±¡åŒ…å«ä¸€ä¸ªrootå±æ€§ï¼Œè¿™æ—¶rootå°±ä¸ä¸ºnulläº†ï¼Œè€Œæ˜¯ä¸€ä¸ªdiv</p>
</blockquote>
<h1 id="ä¸ºtoy-reactæ·»åŠ ç”Ÿå‘½å‘¨æœŸ"><a href="#ä¸ºtoy-reactæ·»åŠ ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ä¸ºtoy-reactæ·»åŠ ç”Ÿå‘½å‘¨æœŸ"></a>ä¸ºtoy-reactæ·»åŠ ç”Ÿå‘½å‘¨æœŸ</h1><p>åœ¨å®ç°äº†ToyReactçš„è‡ªå®šä¹‰ç»„ä»¶çš„jsxè¯­æ³•åï¼Œæˆ‘ä»¬çš„ToyReactå¯ä»¥è·‘èµ·æ¥å•¦</p>
<p>âœ¿âœ¿ãƒ½(Â°â–½Â°)ãƒâœ¿</p>
<p>ä½†æ˜¯ï¼ŒToyReactä¸èƒ½è‡ªåŠ¨æ›´æ–°ï¼Œåªæ˜¯ä¸€ä¸ªç©ºå£³å­</p>
<p>(âŠ™ï¸¿âŠ™)</p>
<p>ç°åœ¨å°±è®©æˆ‘ä»¬å®ç°domçš„æ›´æ–°ï¼Œä»¥åŠsetStateçš„æ”¯æŒå§~</p>
<h2 id="1-stateçš„å®ç°"><a href="#1-stateçš„å®ç°" class="headerlink" title="1. stateçš„å®ç°"></a>1. stateçš„å®ç°</h2><p>åœ¨reactä¸­ï¼Œè‡ªå®šä¹‰ç»„ä»¶æ‹¥æœ‰è‡ªå·±çš„stateï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºï¼Œ<code>Component</code>æ˜¯ä¸éœ€è¦æœ‰è‡ªå·±çš„stateï¼Œä½†éœ€è¦è®¾ç½®setStateæ–¹æ³•ï¼Œå·²ä½¿è‡ªå®šä¹‰ç»„ä»¶è°ƒç”¨setState</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">	<span class="title">constructor</span> (<span class="params"></span>) &#123;</span><br><span class="line">    	<span class="comment">// æ‰§è¡ŒComponentçš„æ„é€ å‡½æ•°</span></span><br><span class="line">    	<span class="built_in">super</span>()</span><br><span class="line">        <span class="built_in">this</span>.state = &#123;</span><br><span class="line">        	a: <span class="number">1</span>,</span><br><span class="line">            b: <span class="number">2</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    render () &#123;</span><br><span class="line">    	<span class="keyword">return</span> &lt;div&gt;</span><br><span class="line">     		&lt;h1&gt;MyComponent&lt;/h1&gt;</span><br><span class="line">            &lt;span&gt;&#123;<span class="built_in">this</span>.state.a.toString()&#125;&lt;/span&gt;</span><br><span class="line">            &#123;<span class="built_in">this</span>.children&#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-ToyReact-domæ›´æ–°"><a href="#2-ToyReact-domæ›´æ–°" class="headerlink" title="2. ToyReact domæ›´æ–°"></a>2. ToyReact domæ›´æ–°</h2><p>ä¹‹å‰çš„renderå‡½æ•°æ˜¯åŸºäºrootå®ç°çš„ï¼Œæ˜¯ä¸€ä¸ªâ€œå–å¾—è‡ªå®šä¹‰ç»„ä»¶çš„root -&gt; å–å¾—rootä¸­è‡ªå®šä¹‰ç»„ä»¶çš„root -&gt; é€’å½’ç›´è‡³TextWrapperæˆ–è€…ElementWrapper(åŒ…å«çœŸæ­£çš„root)â€</p>
<p>è¦æ›´æ–°domï¼Œæˆ‘ä»¬éœ€è¦é”å®šèŠ‚ç‚¹çš„ä½ç½®ã€‚åœ¨reactä¸­ï¼Œå› ä¸ºé‡‡ç”¨äº†è™šæ‹Ÿdomï¼Œæ‰€ä»¥æ›´æ–°domä¼šååˆ†ç²¾å·§ã€‚è€Œç›®å‰ToyReacté‡‡ç”¨çš„æ˜¯å®é™…domï¼Œæ‰€ä»¥**æ›´æ–°domæ„å‘³ç€é‡æ–°æ¸²æŸ“æ•´ä¸ª<code>this.root</code>**ï¼Œä½†æ˜¯æˆ‘ä»¬ä¾æ—§å¯ä»¥é€šè¿‡<code>Range</code>APIå®ç°domçš„å®šä½</p>
<p>æˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹ä¸€ä¸ªä¸å¤ªå¸¸ç”¨çš„api <code>range</code>ï¼š<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Range"> Rangeçš„MDNæ–‡æ¡£</a></p>
<h3 id="rangeçš„å®šä¹‰å’Œ-APIçš„ç®€å•ä½¿ç”¨"><a href="#rangeçš„å®šä¹‰å’Œ-APIçš„ç®€å•ä½¿ç”¨" class="headerlink" title="rangeçš„å®šä¹‰å’Œ APIçš„ç®€å•ä½¿ç”¨"></a>rangeçš„å®šä¹‰å’Œ APIçš„ç®€å•ä½¿ç”¨</h3><p>MDNæ˜¯è¿™æ ·å®šä¹‰å®ƒçš„: <code>Range æ¥å£è¡¨ç¤ºä¸€ä¸ªåŒ…å«èŠ‚ç‚¹ä¸æ–‡æœ¬èŠ‚ç‚¹çš„ä¸€éƒ¨åˆ†çš„æ–‡æ¡£ç‰‡æ®µ</code>.æˆ‘è®¤ä¸ºåœ¨æ­¤åŸºç¡€ä¸Š,ç¨ç¨ä¿®æ”¹ä¸€ä¸‹ä¼šæ›´å¥½ç†è§£ã€‚ <code> Range æ¥å£èƒ½å¤Ÿè¡¨ç¤ºæ–‡æ¡£ä¸­ä»»æ„èŠ‚ç‚¹ä¹‹é—´çš„ä¸€éƒ¨åˆ†æ–‡æ¡£(HTML DOM)ç‰‡æ®µã€‚</code>ã€‚</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;p1&quot;</span>&gt;</span> hello<span class="tag">&lt;<span class="name">span</span>&gt;</span> world !<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span> world !<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>Range.setStart(startNode, startOffset) è®¾ç½®Rangeçš„èµ·ç‚¹</p>
<p>æ¥æ”¶äºŒä¸ªå‚æ•°ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯èŠ‚ç‚¹, ç¬¬äºŒä¸ªå‚æ•°æ˜¯èŠ‚ç‚¹çš„åç§»é‡ã€‚æ¯”å¦‚æ‹¿ä¸Šé¢çš„ä¾‹å­æ¥è¯´:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> p1 = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;p1&#x27;</span>)</span><br><span class="line">range.setStart(p1, <span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<p>rangeçš„èµ·å§‹ä½ç½®åº”è¯¥æ˜¯</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">            rangeèµ·å§‹ä½ç½®</span><br><span class="line">                |</span><br><span class="line">                |</span><br><span class="line">                |  </span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;p1&quot;</span>&gt;</span>hello <span class="tag">&lt;<span class="name">span</span>&gt;</span> world !<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span> world !<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆå¦‚æœ<code>setStart</code>çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯0,é‚£ä¹ˆrangeçš„èµ·å§‹ä½ç½®åˆ™æ˜¯:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">        rangeèµ·å§‹ä½ç½®</span><br><span class="line">            |</span><br><span class="line">            |</span><br><span class="line">            |  </span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;p1&quot;</span>&gt;</span>hello <span class="tag">&lt;<span class="name">span</span>&gt;</span> world !<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span> world !<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å…¶å®å¾ˆå®¹æ˜“ç†è§£ï¼Œp1å…ƒç´ èŠ‚ç‚¹ä¸‹é¢æœ‰ä¸‰ä¸ªå­èŠ‚ç‚¹ã€‚ä¸€ä¸ªæ˜¯æ–‡æœ¬èŠ‚ç‚¹hello, å¦å¤–ä¸¤ä¸ªåˆ™æ˜¯å…ƒç´ èŠ‚ç‚¹ <code>&lt;span&gt; world !&lt;/span&gt;</code>ã€‚</p>
</li>
<li><p>Range.setEnd(startNode, startOffset) è®¾ç½®Rangeçš„ç»“æŸä½ç½®ã€‚</p>
<p>æ¥æ”¶äºŒä¸ªå‚æ•°ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯èŠ‚ç‚¹, ç¬¬äºŒä¸ªå‚æ•°æ˜¯èŠ‚ç‚¹çš„åç§»é‡ã€‚æˆ‘ä»¬è¿˜æ˜¯æ‹¿ä¸Šé¢çš„ä¾‹å­æ¥è¯´:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> p1 = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;p1&#x27;</span>)</span><br><span class="line">range.setEnd(p1, p1.childNodes.length)</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">													rangeç»“æŸä½ç½®</span><br><span class="line">                                                        |</span><br><span class="line">                                                        |</span><br><span class="line">                                                        |  </span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;p1&quot;</span>&gt;</span>hello <span class="tag">&lt;<span class="name">span</span>&gt;</span> world !<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span> world !<span class="tag">&lt;/<span class="name">span</span>&gt;</span> <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Range.insertNode(Node) åœ¨Rangeçš„èµ·å§‹ä½ç½®æ’å…¥èŠ‚ç‚¹ã€‚</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;p1&quot;</span>&gt;</span> hello<span class="tag">&lt;<span class="name">span</span>&gt;</span> world !<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span> world !<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span> world!<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> range = <span class="built_in">document</span>.createRange()</span><br><span class="line"><span class="keyword">const</span> p1 = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;p1&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> element = <span class="built_in">document</span>.createElement(<span class="string">&#x27;p&#x27;</span>)</span><br><span class="line">element.appendChild(<span class="built_in">document</span>.createTextNode(<span class="string">&#x27;123&#x27;</span>))</span><br><span class="line">range.setStart(p1, <span class="number">0</span>)</span><br><span class="line">range.setEnd(p1, p1.childNodes.length)</span><br><span class="line">range.insertNode(element)</span><br></pre></td></tr></table></figure>

<p>å½“æ‰§è¡Œå®Œ<code>insertNode</code> æ–¹æ³•å,ä¼šåœ¨æ–‡æœ¬èŠ‚ç‚¹helloå‰é¢æ·»åŠ ä¸€ä¸ªpå…ƒç´ èŠ‚ç‚¹ã€‚</p>
</li>
<li><p>Range.deleteContents() ç§»é™¤æ¥è‡ª Documentçš„Range å†…å®¹ã€‚</p>
<p>è°ƒç”¨æ­¤æ–¹æ³•ä¼šåˆ é™¤rangeå†…çš„æ‰€æœ‰èŠ‚ç‚¹ã€‚</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;p1&quot;</span>&gt;</span> hello<span class="tag">&lt;<span class="name">span</span>&gt;</span> world !<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span> world !<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span> world!<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> range = <span class="built_in">document</span>.createRange()</span><br><span class="line"><span class="keyword">const</span> p1 = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;p1&#x27;</span>)</span><br><span class="line">range.setStart(p1, <span class="number">0</span>)</span><br><span class="line">range.setEnd(p1, p1.childNodes.length)</span><br><span class="line">range.deleteContents()</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>ä»¥ä¸Šä»£ç æ‰§è¡Œåp1èŠ‚ç‚¹ä¸‹é¢çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½å°†è¢«åˆ é™¤ã€‚</p>
<blockquote>
<p>rangeçš„å…¶ä»–apiæœ¬ç¯‡æ–‡ç« ä¸­ä¸ä¼šæ¶‰åŠ,å› æ­¤å°±ä¸ä¸€ä¸€ä»‹ç»äº†ã€‚</p>
</blockquote>
<h3 id="2-1-é‡å†™Componentçš„get-root"><a href="#2-1-é‡å†™Componentçš„get-root" class="headerlink" title="2.1 é‡å†™Componentçš„get root"></a>2.1 é‡å†™Componentçš„get root</h3><p>æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦ç”¨rangeå»é‡æ„ä¹‹å‰çš„ä»£ç å‘¢ï¼Ÿæˆ‘è®¤ä¸ºä¸»è¦æ˜¯å‡ºäºä»¥ä¸‹çš„è€ƒè™‘:</p>
<ul>
<li>1.ä½¿ç”¨rangeæˆ‘ä»¬å¯ä»¥åœ¨ä»»æ„èŠ‚ç‚¹å¤„æ’å…¥DOM</li>
<li>2.ä¸ºæ¥ä¸‹æ¥çš„é‡æ–°æ¸²æŸ“ä¸è™šæ‹ŸDOMçš„æ¯”å¯¹åšé“ºå«</li>
</ul>
<p>æˆ‘ä»¬ä¿®æ”¹çš„åŸºæœ¬æ€è·¯æ˜¯:</p>
<ul>
<li>ä»æ¸²æŸ“DOMçš„åœ°æ–¹å¼€å§‹ç€æ‰‹, ä½¿ç”¨rangeå»å®ŒæˆDOMçš„å®é™…æ“ä½œ</li>
<li>ä»”ç»†é˜…è¯»ä¹‹å‰çš„ä»£ç , ä½ ä¼šå‘ç°å®ƒæ— æ³•è¿›è¡Œé‡æ–°æ¸²æŸ“ã€‚å› æ­¤æˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªç§æœ‰çš„æ–¹æ³•èƒ½å¤Ÿè®©DOMæ ‘é‡æ–°renderã€‚</li>
</ul>
<p>ä¸ºäº†è®©æ¸²æŸ“DOMæ ‘çš„æ–¹æ³•, å˜å¾—ä¸é‚£ä¹ˆå®¹æ˜“è®©å¤–éƒ¨è°ƒç”¨, æˆ‘ä»¬ä½¿ç”¨<code>Symbol</code> è¿”å›çš„å”¯ä¸€æ ‡è¯†ç¬¦ä½œä¸ºå‡½æ•°åã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é€šè¿‡symbolå®šä¹‰æ–¹æ³•åç§°ï¼Œä¿è¯ç§æœ‰æ€§</span></span><br><span class="line"><span class="keyword">const</span> RENDER_TO_DOM = <span class="built_in">Symbol</span>(<span class="string">&quot;render to dom&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="title">constructor</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="built_in">this</span>.props = <span class="built_in">Object</span>.create(<span class="literal">null</span>)</span><br><span class="line">        <span class="built_in">this</span>.children = []</span><br><span class="line">        <span class="built_in">this</span>._root = <span class="literal">null</span></span><br><span class="line">        <span class="built_in">this</span>._range = <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    setAttribute (name, value) &#123;</span><br><span class="line">        <span class="built_in">this</span>.props[name] = value</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    appendChild (component) &#123;</span><br><span class="line">        <span class="built_in">this</span>.children.push(component)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä½¿ç”¨[]å°†Symbolä½œä¸ºå‡½æ•°å</span></span><br><span class="line">    <span class="comment">// ä¼ å…¥çš„æ˜¯range</span></span><br><span class="line">    [RENDER_TO_DOM] (range) &#123;</span><br><span class="line">    	<span class="comment">// ç»„ä»¶çš„this.render()ä¼šè¿”å›ç»„ä»¶ï¼Œä¹‹åå†è°ƒç”¨ç»„ä»¶çš„[RENDER_TO_DOM]æ–¹æ³•</span></span><br><span class="line">    	<span class="built_in">this</span>.render()[RENDER_TO_DOM](range)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ä¹‹å‰çš„get root æ–¹æ³•è¢«[RENDER_TO_DOM]æ›¿ä»£</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬åœ¨Componentç±»ä¸­æ·»åŠ ä¸€ä¸ªç§æœ‰çš„æ–¹æ³•, å› ä¸ºthis.render()è¿”å›çš„å€¼æœ‰å¯èƒ½æ˜¯ä¸€ä¸ªComponent, ElementWrapper, TextWrapperã€‚å› æ­¤åœ¨å…¶ä½™äºŒä¸ªç±»ä¸­, æˆ‘ä»¬ ä¹Ÿéœ€è¦å»æ·»åŠ <code>RENDER_TO_DOM</code> æ–¹æ³•ã€‚</p>
<h3 id="2-2-é‡å†™TextWrapperå’ŒElementWrapper"><a href="#2-2-é‡å†™TextWrapperå’ŒElementWrapper" class="headerlink" title="2.2 é‡å†™TextWrapperå’ŒElementWrapper"></a>2.2 é‡å†™TextWrapperå’ŒElementWrapper</h3><p>åœ¨æ›´æ–°äº†Componentçš„<code>[RENDER_TO_DOM]</code>æ–¹æ³•ä¹‹åï¼Œéœ€è¦åœ¨TextWrapperå’ŒElementWrapperä¸­å¢åŠ å¯¹åº”çš„<code>[RENDER_TO_DOM]</code>æ–¹æ³•ï¼Œå°†å®DOMæ¸²æŸ“åˆ°é¡µé¢ã€‚å› æ­¤åœ¨<code>RENDER_TO_DOM</code> ä¸­æˆ‘ä»¬éœ€è¦å¾€rangeä¸­æ’å…¥èŠ‚ç‚¹ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ElementWrapper</span> </span>&#123;</span><br><span class="line">    <span class="title">constructor</span> (<span class="params">type</span>) &#123;</span><br><span class="line">        <span class="built_in">this</span>.root = <span class="built_in">document</span>.createElement(type)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    setAttribute (name, value) &#123;</span><br><span class="line">        <span class="built_in">this</span>.root.setAttribute(name, value)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¢åŠ [RENDER_TO_DOM]æ–¹æ³•</span></span><br><span class="line">    [RENDER_TO_DOM] (range) &#123;</span><br><span class="line">    	<span class="comment">// é¦–å…ˆä»æ–‡æ¡£ä¸­ç§»é™¤ Range åŒ…å«çš„å†…å®¹ã€‚</span></span><br><span class="line">    	range.deleteContents()</span><br><span class="line">        <span class="comment">// å†å°†rootæ’å…¥rangeï¼Œå®Œæˆæ¸²æŸ“</span></span><br><span class="line">        range.insertNode(<span class="built_in">this</span>.root)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç”±äºé‡‡ç”¨äº†rangeï¼Œæ‰€ä»¥å¢åŠ childä¹Ÿè¦ä¿®æ”¹</span></span><br><span class="line">    appendChild (component) &#123;</span><br><span class="line">    	<span class="keyword">let</span> range = <span class="built_in">document</span>.createRange()</span><br><span class="line">    	<span class="comment">// å°†æ–°å¢çš„å…ƒç´ ç½®äºrangeæœ«å°¾</span></span><br><span class="line">    	range.setStart(<span class="built_in">this</span>.root, <span class="built_in">this</span>.root.childNodes.length)</span><br><span class="line">    	range.setEnd(<span class="built_in">this</span>.root, <span class="built_in">this</span>.root.childNodes.length)</span><br><span class="line">    	component[RENDER_TO_DOM](range)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ–‡æœ¬èŠ‚ç‚¹ä¸éœ€è¦è®¾ç½®å±æ€§åŠæ·»åŠ å­å…ƒç´ </span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TextWrapper</span> </span>&#123;</span><br><span class="line">    <span class="title">constructor</span> (<span class="params">content</span>) &#123;</span><br><span class="line">        <span class="built_in">this</span>.root = <span class="built_in">document</span>.createTextNode(content)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¢åŠ [RENDER_TO_DOM]æ–¹æ³•</span></span><br><span class="line">    [RENDER_TO_DOM] (range) &#123;</span><br><span class="line">    	<span class="comment">// é¦–å…ˆä»æ–‡æ¡£ä¸­ç§»é™¤ Range åŒ…å«çš„å†…å®¹ã€‚</span></span><br><span class="line">    	range.deleteContents()</span><br><span class="line">        <span class="comment">// å†å°†rootæ’å…¥rangeï¼Œå®Œæˆæ¸²æŸ“</span></span><br><span class="line">        range.insertNode(<span class="built_in">this</span>.root)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-3-æ›´æ–°renderå‡½æ•°"><a href="#2-3-æ›´æ–°renderå‡½æ•°" class="headerlink" title="2.3 æ›´æ–°renderå‡½æ•°"></a>2.3 æ›´æ–°renderå‡½æ•°</h3><p>ç”±äºæˆ‘ä»¬ä¸å†ä½¿ç”¨<code>get root()</code> æ–¹æ³•æ¥è·å–å®DOM, å› æ­¤æˆ‘ä»¬é€šè¿‡è°ƒç”¨ <code>RENDER_TO_DOM</code> æ¥æ’å…¥èŠ‚ç‚¹ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">ToyReact</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> render (component, parentElement) &#123;</span><br><span class="line">        <span class="comment">// åœ¨parentElementå°¾éƒ¨å¢åŠ range</span></span><br><span class="line">        <span class="keyword">let</span> range = <span class="built_in">document</span>.createRange()</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å°†rangeçš„startèŠ‚ç‚¹è®¾ç½®ä¸ºparentElementï¼Œoffsetä¸º0ï¼Œè¯´æ˜rangeå°†åŒ…å«parentElementçš„å…¨éƒ¨children</span></span><br><span class="line">        range.setStart(parentElement, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å› ä¸ºparentElementä¸­ä¼šæœ‰æ–‡æœ¬èŠ‚ç‚¹å’Œæ³¨é‡ŠèŠ‚ç‚¹ï¼Œæ‰€ä»¥offsetä¸æ˜¯parentElement.children.length</span></span><br><span class="line">        range.setEnd(parentElement, parentElement.childNodes.length)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ¸…ç©ºrange</span></span><br><span class="line">        range.deleteContents()</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è°ƒç”¨[RENDER_TO_DOM]æ–¹æ³•</span></span><br><span class="line">        component[RENDER_TO_DOM](range)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-4-æ”¯æŒé‡æ–°ç»˜åˆ¶dom"><a href="#2-4-æ”¯æŒé‡æ–°ç»˜åˆ¶dom" class="headerlink" title="2.4 æ”¯æŒé‡æ–°ç»˜åˆ¶dom"></a>2.4 æ”¯æŒé‡æ–°ç»˜åˆ¶dom</h3><p>éœ€è¦ä¿®æ”¹<code>[RENDER_TO_DOM]</code>æ–¹æ³•</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ElementWrapper</span> </span>&#123;</span><br><span class="line">    <span class="title">constructor</span> (<span class="params">type</span>) &#123;</span><br><span class="line">        <span class="built_in">this</span>.root = <span class="built_in">document</span>.createElement(type)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    setAttribute (name, value) &#123;</span><br><span class="line">        <span class="built_in">this</span>.root.setAttribute(name, value)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ”¯æŒdomé‡ç»˜</span></span><br><span class="line">    [RENDER_TO_DOM] (range) &#123;</span><br><span class="line">    	range.deleteContents()</span><br><span class="line">        range.insertNode(<span class="built_in">this</span>.root)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç”±äºé‡‡ç”¨äº†rangeï¼Œæ‰€ä»¥å¢åŠ childä¹Ÿè¦ä¿®æ”¹</span></span><br><span class="line">    appendChild (component) &#123;</span><br><span class="line">    	<span class="keyword">let</span> range = <span class="built_in">document</span>.createRange()</span><br><span class="line">    	<span class="comment">// å°†æ–°å¢çš„å…ƒç´ ç½®äºrangeæœ«å°¾</span></span><br><span class="line">    	range.setStart(<span class="built_in">this</span>.root, <span class="built_in">this</span>.root.childNodes.length)</span><br><span class="line">    	range.setEnd(<span class="built_in">this</span>.root, <span class="built_in">this</span>.root.childNodes.length)</span><br><span class="line">    	component[RENDER_TO_DOM](range)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–‡æœ¬èŠ‚ç‚¹ä¸éœ€è¦è®¾ç½®å±æ€§åŠæ·»åŠ å­å…ƒç´ </span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TextWrapper</span> </span>&#123;</span><br><span class="line">    <span class="title">constructor</span> (<span class="params">content</span>) &#123;</span><br><span class="line">        <span class="built_in">this</span>.root = <span class="built_in">document</span>.createTextNode(content)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¢åŠ [RENDER_TO_DOM]æ–¹æ³•</span></span><br><span class="line">    [RENDER_TO_DOM] (range) &#123;</span><br><span class="line">    	range.deleteContents()</span><br><span class="line">        range.insertNode(<span class="built_in">this</span>.root)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="title">constructor</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="built_in">this</span>.props = <span class="built_in">Object</span>.create(<span class="literal">null</span>)</span><br><span class="line">        <span class="built_in">this</span>.children = []</span><br><span class="line">        <span class="built_in">this</span>._root = <span class="literal">null</span></span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–_range</span></span><br><span class="line">        <span class="built_in">this</span>._range = <span class="literal">null</span>      </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    setAttribute (name, value) &#123;</span><br><span class="line">        <span class="built_in">this</span>.props[name] = value</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    appendChild (component) &#123;</span><br><span class="line">        <span class="built_in">this</span>.children.push(component)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    [RENDER_TO_DOM] (range) &#123;</span><br><span class="line">    	<span class="built_in">this</span>._range = range</span><br><span class="line">    	<span class="built_in">this</span>.render()[RENDER_TO_DOM](range)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å®šä¹‰é‡ç»˜æ–¹æ³•</span></span><br><span class="line">    rerender () &#123;</span><br><span class="line">    	<span class="built_in">this</span>._range.deleteContents()</span><br><span class="line">        <span class="built_in">this</span>[RENDER_TO_DOM](<span class="built_in">this</span>._range)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨è‡ªå®šä¹‰ç»„ä»¶ä¸­è°ƒç”¨é‡ç»˜æ–¹æ³•ï¼Œæ”¯æŒsetStateçš„æ“ä½œäº†ã€‚æˆ‘ä»¬éœ€è¦æœ‰ä¸€ä¸ªä¸»åŠ¨çš„è¡Œä¸ºå»æ›´æ–°é¡µé¢ã€‚ æˆ‘ä»¬åœ¨é¡µé¢æ·»åŠ ä¸€ä¸ªè®¡æ•°å™¨, æ¯ç‚¹å‡»ä¸€æ¬¡æŒ‰é’®, é¡µé¢ä¸Šçš„æ•°å­—åŠ ä¸€.</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">	<span class="title">constructor</span> (<span class="params"></span>) &#123;</span><br><span class="line">    	<span class="comment">// æ‰§è¡ŒComponentçš„æ„é€ å‡½æ•°</span></span><br><span class="line">    	<span class="built_in">super</span>()</span><br><span class="line">        <span class="built_in">this</span>.state = &#123;</span><br><span class="line">        	a: <span class="number">1</span>,</span><br><span class="line">            b: <span class="number">2</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    render () &#123;</span><br><span class="line">    	<span class="keyword">return</span> &lt;div&gt;</span><br><span class="line">            &lt;h1&gt;MyComponent&lt;/h1&gt;</span><br><span class="line">            &lt;button onClick=&#123;<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="built_in">this</span>.state.a++</span><br><span class="line">                <span class="built_in">this</span>.rerender()</span><br><span class="line">            &#125;&#125;&gt;&lt;/button&gt;</span><br><span class="line">            &lt;span&gt;&#123;<span class="built_in">this</span>.state.a.toString()&#125;&lt;/span&gt;</span><br><span class="line">            &lt;span&gt;&#123;<span class="built_in">this</span>.state.b.toString()&#125;&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-5-æ”¯æŒè‡ªå®šä¹‰äº‹ä»¶äº‹ä»¶ç»‘å®š"><a href="#2-5-æ”¯æŒè‡ªå®šä¹‰äº‹ä»¶äº‹ä»¶ç»‘å®š" class="headerlink" title="2.5 æ”¯æŒè‡ªå®šä¹‰äº‹ä»¶äº‹ä»¶ç»‘å®š"></a>2.5 æ”¯æŒè‡ªå®šä¹‰äº‹ä»¶äº‹ä»¶ç»‘å®š</h3><p>æˆ‘ä»¬ç‚¹å‡»onClické¡µé¢ä¼¼ä¹æ²¡æœ‰ååº”ã€‚å…¶å®è¿™è¾¹æœ‰äºŒä¸ªå¾ˆé‡è¦çš„ç‚¹æ²¡æœ‰å¤„ç†:</p>
<ul>
<li>æˆ‘ä»¬éœ€è¦å¤„ç†ç±»ä¼¼<code>onClick</code> ç­‰äº‹ä»¶</li>
<li>æˆ‘ä»¬éœ€è¦å°†æ”¹å˜åcountçš„å€¼é‡æ–°æ¸²æŸ“åˆ°é¡µé¢ä¸Š</li>
</ul>
<p>é¦–å…ˆåªæœ‰å…ƒç´ èŠ‚ç‚¹ä¸Šæ‰èƒ½ç»‘å®šäº‹ä»¶, å› æ­¤æˆ‘ä»¬è‚¯å®šæ˜¯åœ¨<code>ElementWrapper</code>ç±»ä¸­è¿›è¡Œä¿®æ”¹ã€‚æˆ‘ä»¬å†™ä¸€ä¸ªç®€å•çš„æ­£åˆ™æ¥åŒ¹é…æ‰€æœ‰onå¼€å¤´çš„äº‹ä»¶, æ¯”å¦‚onClick, onHover, onMouseUpâ€¦..ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ElementWrapper</span> </span>&#123;</span><br><span class="line">    <span class="title">constructor</span> (<span class="params">type</span>) &#123;</span><br><span class="line">        <span class="built_in">this</span>.root = <span class="built_in">document</span>.createElement(type)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ”¯æŒäº‹ä»¶ç»‘å®š</span></span><br><span class="line">    setAttribute (name, value) &#123;</span><br><span class="line">    	<span class="comment">// é‡‡ç”¨æ­£åˆ™ï¼Œåˆ¤æ–­nameæ˜¯å¦ä¸ºonå¼€å¤´</span></span><br><span class="line">        <span class="keyword">if</span> (name.match(<span class="regexp">/^on([\s\S]+)/</span>) &#123;</span><br><span class="line">        	<span class="comment">// [\s\S] è¡¨ç¤ºå…¨éƒ¨å­—ç¬¦ \sä¸ºéç©ºç™½ï¼Œ\Sä¸ºç©ºç™½ï¼Œä¸¤ä¸ªé›†åˆäº’è¡¥</span></span><br><span class="line">            <span class="comment">// ç”±äºæ­¤å¤„é‡‡ç”¨matchï¼Œæ‰€ä»¥RegExp.$1å°†æ‹¿åˆ°åŒ¹é…çš„å­—ç¬¦ï¼Œå³onä¹‹åçš„éƒ¨åˆ†</span></span><br><span class="line">            <span class="comment">// RegExp.$1.replace(/^[\s\S]/, c =&gt; c.toLowerCase())</span></span><br><span class="line">            <span class="comment">// ç¡®ä¿äº‹ä»¶åå°å†™ï¼Œå°†ç¬¬ä¸€ä¸ªå­—æ¯è½¬æ¢ä¸ºå°å†™</span></span><br><span class="line">            <span class="built_in">this</span>.root.addEventListener(<span class="built_in">RegExp</span>.$1.replace(<span class="regexp">/^[\s\S]/</span>, <span class="function"><span class="params">c</span> =&gt;</span> c.toLowerCase()), value)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        	<span class="comment">// å…¶ä»–å±æ€§ï¼Œç›´æ¥è°ƒç”¨rootçš„setAttributeæ–¹æ³•</span></span><br><span class="line">        	<span class="built_in">this</span>.root.setAttribute(name, value)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    [RENDER_TO_DOM] (range) &#123;</span><br><span class="line">    	range.deleteContents()</span><br><span class="line">        range.insertNode(<span class="built_in">this</span>.root)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    appendChild (component) &#123;</span><br><span class="line">    	<span class="keyword">let</span> range = <span class="built_in">document</span>.createRange()</span><br><span class="line">    	range.setStart(<span class="built_in">this</span>.root, <span class="built_in">this</span>.root.childNodes.length)</span><br><span class="line">    	range.setEnd(<span class="built_in">this</span>.root, <span class="built_in">this</span>.root.childNodes.length)</span><br><span class="line">    	component[RENDER_TO_DOM](range)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-å®ç°setState"><a href="#3-å®ç°setState" class="headerlink" title="3. å®ç°setState"></a>3. å®ç°setState</h2><p>ç›®å‰ï¼Œæˆ‘ä»¬çš„stateå¯ä»¥å®ç°æ›´æ–°ï¼Œä½†æ˜¯å¹¶ä¸èƒ½å®ç°stateåŸæœ‰çŠ¶æ€çš„å­˜å‚¨ï¼Œåªæ˜¯å•çº¯çš„è¦†ç›–ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦å®Œå–„setStateï¼Œå®ç°stateçš„æ·±æ‹·è´ï¼Œæ›´æ–°setStateæ–¹æ³•ä¸»è¦æ˜¯å°†æ–°çš„stateä¸è€çš„stateæ¯”è¾ƒ, ç„¶åè¿›è¡Œä¸€ä¸ªæ·±æ‹·è´çš„æ“ä½œã€‚å¦‚æœthis.stateä¸å­˜åœ¨æˆ–è€…ç±»å‹ä¸æ˜¯å¯¹è±¡çš„æ—¶å€™, æˆ‘ä»¬ç›´æ¥ä½¿ç”¨æ–°çš„stateå»æ›¿æ¢å®ƒã€‚ ç„¶åé€šè¿‡é€’å½’å°†æ–°çš„stateä¸­çš„å€¼ç›´æ¥èµ‹å€¼åˆ°æ—§çš„å¯¹åº”çš„stateå€¼ã€‚</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Componentçš„setStateæ–¹æ³•</span></span><br><span class="line">setState (newState) &#123;</span><br><span class="line">    <span class="comment">// stateä¸ºnullæ—¶çš„å¤„ç†</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.state === <span class="literal">null</span> || <span class="keyword">typeof</span> <span class="built_in">this</span>.state !== <span class="string">&quot;object&quot;</span>) &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœstateä¸ºnullæˆ–ä¸æ˜¯å¯¹è±¡ï¼Œç›´æ¥ä¸ºstateèµ‹å€¼newStateï¼Œå¹¶é‡æ–°æ¸²æŸ“ç»„ä»¶</span></span><br><span class="line">        <span class="built_in">this</span>.state = newState</span><br><span class="line">        <span class="built_in">this</span>.rerender()</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é‡‡ç”¨é€’å½’çš„æ–¹å¼è®¿é—®state</span></span><br><span class="line">    <span class="keyword">let</span> merge = <span class="function">(<span class="params">oldState, newState</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> newState) &#123;</span><br><span class="line">            <span class="keyword">if</span> (oldState[key] === <span class="literal">null</span> || <span class="keyword">typeof</span> oldState[key] !== <span class="string">&#x27;object&#x27;</span>) &#123;</span><br><span class="line">                oldState[key] = newState[key]</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// å¦‚æœoldSateçš„på±æ€§ä¸ºå¯¹è±¡ï¼Œé‚£ä¹ˆå°±é€’å½’è°ƒç”¨mergeï¼Œå®ç°æ·±æ‹·è´</span></span><br><span class="line">                merge(oldState[key], newState[key])</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    merge(<span class="built_in">this</span>.state, newState)</span><br><span class="line">    <span class="built_in">this</span>.rerender()</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="title">constructor</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// æ‰§è¡ŒComponentçš„æ„é€ å‡½æ•°</span></span><br><span class="line">        <span class="built_in">super</span>()</span><br><span class="line">        <span class="built_in">this</span>.state = &#123;</span><br><span class="line">            a: <span class="number">1</span>,</span><br><span class="line">            b: <span class="number">2</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render () &#123;</span><br><span class="line">        <span class="keyword">return</span> &lt;div&gt;</span><br><span class="line">            &lt;h1&gt;MyComponent&lt;/h1&gt;</span><br><span class="line">            &lt;button onClick=&#123;<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="built_in">this</span>.setState(&#123;<span class="attr">a</span>: <span class="built_in">this</span>.state.a + <span class="number">1</span>&#125;);</span><br><span class="line">                &#125;&#125;&gt;&lt;/button&gt;</span><br><span class="line">            &lt;span&gt;&#123;<span class="built_in">this</span>.state.a.toString()&#125;&lt;/span&gt;</span><br><span class="line">            &lt;span&gt;&#123;<span class="built_in">this</span>.state.b.toString()&#125;&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ­¤æ—¶çš„main.jså…¨éƒ¨å†…å®¹æ­£å¸¸é€šè¿‡ç¼–è¯‘å’Œè¿è¡Œ</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Component, ToyReact &#125; <span class="keyword">from</span> <span class="string">&#x27;./toy-react.js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">Component</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// æ‰§è¡ŒComponentçš„æ„é€ å‡½æ•°</span></span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">        <span class="built_in">this</span>.state = &#123;</span><br><span class="line">            a: <span class="number">1</span>,</span><br><span class="line">            b: <span class="number">2</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> &lt;div&gt;</span><br><span class="line">            &lt;h1&gt;my component&lt;/h1&gt;</span><br><span class="line">            &lt;button onClick=&#123;<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="built_in">this</span>.setState(&#123;<span class="attr">a</span>: <span class="built_in">this</span>.state.a + <span class="number">1</span>&#125;);</span><br><span class="line">                &#125;&#125;&gt;add&lt;/button&gt;</span><br><span class="line">            &lt;span&gt;&#123;<span class="built_in">this</span>.state.a.toString()&#125;&lt;/span&gt;</span><br><span class="line">            &lt;span&gt;&#123;<span class="built_in">this</span>.state.b.toString()&#125;&lt;/span&gt;</span><br><span class="line">            &#123;<span class="built_in">this</span>.children&#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ToyReact.render(<span class="xml"><span class="tag">&lt;<span class="name">MyComponent</span> <span class="attr">id</span>=<span class="string">&quot;a&quot;</span> <span class="attr">class</span>=<span class="string">&quot;c&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">           <span class="tag">&lt;<span class="name">div</span>&gt;</span>abc<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">           <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">           <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">       <span class="tag">&lt;/<span class="name">MyComponent</span>&gt;</span></span>, <span class="built_in">document</span>.body)</span><br></pre></td></tr></table></figure>

<h2 id="4-é›†æˆReactå®˜ç½‘ç¤ºä¾‹TicTacToe-demo"><a href="#4-é›†æˆReactå®˜ç½‘ç¤ºä¾‹TicTacToe-demo" class="headerlink" title="4. é›†æˆReactå®˜ç½‘ç¤ºä¾‹TicTacToe demo"></a>4. é›†æˆReactå®˜ç½‘ç¤ºä¾‹TicTacToe demo</h2><p><a target="_blank" rel="noopener" href="https://codepen.io/gaearon/pen/VbbVLg">TicTacToeæ˜¯reactçš„å®˜æ–¹æ•™ç¨‹</a>ï¼Œæˆ‘ä»¬æ‹¿ç°åœ¨toyReactè¯•ç€è·‘ä¸€ä¸‹ä¸­é—´çš„ä¸€ä¸ªè¿‡æ¸¡ä¾‹å­ï¼Œé¡ºä¾¿å¯¹ToyReactè¿›è¡Œä¸€äº›å°ä¿®å°è¡¥å§~</p>
<p>ğŸƒğŸƒğŸƒ</p>
<p>ä¸è´Ÿä¼—æœ›âœ¿âœ¿ãƒ½(Â°â–½Â°)ãƒâœ¿æ²¡æœ‰è¿è¡Œèµ·æ¥</p>
<p>è°ƒè¯•åå‘ç°ï¼Œä¸»è¦é—®é¢˜å­˜åœ¨äº createElementå‡½æ•°çš„insertChildrenæ“ä½œï¼Œæ²¡æœ‰å…¼é¡¾åˆ°childrenä¸ºnullçš„çŠ¶å†µï¼Œè€ŒTicTacToe demoé‡‡ç”¨äº†childrenä¸ºnullçš„è®¾ç½®</p>
<p>æˆ‘ä»¬æ¥ä¿®å¤è¿™ä¸ªé—®é¢˜</p>
<h3 id="4-1-insertChildrenæ”¯æŒchildä¸ºnull"><a href="#4-1-insertChildrenæ”¯æŒchildä¸ºnull" class="headerlink" title="4.1 insertChildrenæ”¯æŒchildä¸ºnull"></a>4.1 insertChildrenæ”¯æŒchildä¸ºnull</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">ToyReact</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> createElement (tagType, attributes, ...children) &#123;</span><br><span class="line">        ... ...</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> insertChildren = <span class="function">(<span class="params">children</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">let</span> child <span class="keyword">of</span> children) &#123;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// å¦‚æœchildä¸ºnullï¼Œä¸åšä»»ä½•å¤„ç†</span></span><br><span class="line">                <span class="keyword">if</span> (child === <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">typeof</span> child === <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">                    child = <span class="keyword">new</span> TextWrapper(child)</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">typeof</span> child === <span class="string">&quot;object&quot;</span> &amp;&amp; child <span class="keyword">instanceof</span> <span class="built_in">Array</span>) &#123;</span><br><span class="line">                    insertChildren(child)</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    element.appendChild(child)</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        insertChildren(children)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> element</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œdemoä¸­çš„é‡‡ç”¨äº†å‡½æ•°ç»„ä»¶ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹ä¸ºclassç»„ä»¶ã€‚å¦å¤–ï¼Œæˆ‘ä»¬çš„toyReactç›®å‰è¿˜æ²¡æœ‰æ”¯æŒclassNameçš„ç»‘å®š</p>
<p>æˆ‘ä»¬éœ€è¦åœ¨ElementWrapperçš„setAttributeæ–¹æ³•ä¸­ï¼Œå®ç°classNameçš„ç»‘å®š</p>
<h3 id="4-2-classNameçš„ç»‘å®š"><a href="#4-2-classNameçš„ç»‘å®š" class="headerlink" title="4.2 classNameçš„ç»‘å®š"></a>4.2 classNameçš„ç»‘å®š</h3><p>ä¿®æ”¹ElementWrapperç±»æ”¯æŒclassNameã€‚æˆ‘ä»¬éœ€è¦å•ç‹¬å¤„ç†<code>className</code>è¿™ä¸ªå±æ€§, å› ä¸ºå…ƒç´ èŠ‚ç‚¹çš„ç±»åæ˜¯é€šè¿‡èµ‹å€¼åˆ°classä¸Šæ‰èƒ½ç”Ÿæ•ˆ</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ElementWrapper</span> </span>&#123;</span><br><span class="line">    <span class="title">constructor</span> (<span class="params">type</span>) &#123;</span><br><span class="line">        <span class="built_in">this</span>.root = <span class="built_in">document</span>.createElement(type)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// é‡‡ç”¨æ­£åˆ™ï¼Œåˆ¤æ–­nameæ˜¯å¦ä¸ºonå¼€å¤´</span></span><br><span class="line">    <span class="keyword">if</span> (name.match(<span class="regexp">/^on([\s\S]+)/</span>)) &#123;</span><br><span class="line">        <span class="comment">// [\s\S] è¡¨ç¤ºå…¨éƒ¨å­—ç¬¦ \sä¸ºéç©ºç™½ï¼Œ\Sä¸ºç©ºç™½ï¼Œä¸¤ä¸ªé›†åˆäº’è¡¥</span></span><br><span class="line">        <span class="comment">// ç”±äºæ­¤å¤„é‡‡ç”¨matchï¼Œæ‰€ä»¥RegExp.$1å°†æ‹¿åˆ°åŒ¹é…çš„å­—ç¬¦ï¼Œå³onä¹‹åçš„éƒ¨åˆ†</span></span><br><span class="line">        <span class="comment">// RegExp.$1.replace(/^[\s\S]/, c =&gt; c.toLowerCase())</span></span><br><span class="line">        <span class="comment">// ç¡®ä¿äº‹ä»¶åå°å†™ï¼Œå°†ç¬¬ä¸€ä¸ªå­—æ¯è½¬æ¢ä¸ºå°å†™</span></span><br><span class="line">        <span class="built_in">this</span>.root.addEventListener(<span class="built_in">RegExp</span>.$1.replace(<span class="regexp">/^[\s\S]/</span>, <span class="function"><span class="params">c</span> =&gt;</span> c.toLowerCase()), value)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (name === <span class="string">&#x27;className&#x27;</span>) &#123; <span class="comment">// é…ç½®å±æ€§</span></span><br><span class="line">        <span class="built_in">this</span>.root.setAttribute(<span class="string">&#x27;class&#x27;</span>, value)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.root.setAttribute(name, value)</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    appendChild (component) &#123;</span><br><span class="line">        <span class="built_in">this</span>.root.appendChild(component.root)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-3-ä¿®å¤ç”±äºrangeè¢«åå¯¼è‡´çš„é—®é¢˜"><a href="#4-3-ä¿®å¤ç”±äºrangeè¢«åå¯¼è‡´çš„é—®é¢˜" class="headerlink" title="4.3 ä¿®å¤ç”±äºrangeè¢«åå¯¼è‡´çš„é—®é¢˜"></a>4.3 ä¿®å¤ç”±äºrangeè¢«åå¯¼è‡´çš„é—®é¢˜</h3><p>æˆ‘ä»¬é€šè¿‡range APIå®ç°äº†ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ï¼Œä½†æ˜¯æˆ‘ä»¬ä½¿ç”¨<code>range.deleteContents()</code>çš„æ—¶æœºï¼Œå¯¼è‡´TicTacToe demoåœ¨é‡æ–°æ¸²æŸ“æ—¶ï¼Œå­˜åœ¨ä¸¢å¤±domçš„æƒ…å†µï¼Œæ‰€ä»¥éœ€è¦ä¿®å¤</p>
<p>é—®é¢˜å­˜åœ¨äºComponentçš„<code>rerender</code>æ–¹æ³•ï¼Œå‡½æ•°æ‰§è¡Œæ—¶ï¼Œä¼šå…ˆæ¸…ç©ºrangeï¼Œè¿™ä¼šå¯¼è‡´ç©ºrangeè¢«ç›¸é‚»çš„rangeâ€œåäº†â€ï¼Œæ‰€ä»¥åœ¨<code>rerender</code>æ‰§è¡Œæ—¶ï¼Œéœ€è¦ä¿è¯rangeä¸ç©ºã€‚</p>
<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦å…ˆæ’å…¥rangeï¼Œå†åˆ é™¤å®ƒ</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    rerender () &#123;</span><br><span class="line">        <span class="keyword">let</span> range = <span class="built_in">document</span>.createRange()</span><br><span class="line">        <span class="comment">// æ–°åˆ›å»ºçš„rangeæ²¡æœ‰å®½åº¦</span></span><br><span class="line">        range.setStart(<span class="built_in">this</span>._range.startContainer, <span class="built_in">this</span>._range.startOffset)</span><br><span class="line">        range.setEnd(<span class="built_in">this</span>._range.startContainer, <span class="built_in">this</span>._range.startOffset)</span><br><span class="line">        <span class="built_in">this</span>[RENDER_TO_DOM](range)</span><br><span class="line">        <span class="built_in">this</span>._range.deleteContents()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯åœ¨Component<code>[RENDER_TO_DOM]</code>æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä¿ç•™äº†<code>this._range</code>ï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥åœ¨<code>rerender</code>æ—¶ç›´æ¥æ¸…ç©º</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="comment">// [RENDER_TO_DOM]æ–¹æ³•ä¿ç•™äº†this._range </span></span><br><span class="line">    [RENDER_TO_DOM] (range) &#123;</span><br><span class="line">        <span class="built_in">this</span>._range = range</span><br><span class="line">        <span class="built_in">this</span>.render()[RENDER_TO_DOM](range)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦æ”¹è¿›ä¸€ä¸‹</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    rerender () &#123;</span><br><span class="line">        <span class="comment">// ä¿å­˜this._range</span></span><br><span class="line">        <span class="keyword">let</span> oldRange = <span class="built_in">this</span>._range</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ–°åˆ›å»ºçš„rangeæ²¡æœ‰å®½åº¦ï¼Œä½†ä¼šæ”¹å˜oldRangeçš„å®½åº¦</span></span><br><span class="line">        <span class="comment">// æ–°åˆ›å»ºçš„rangeåœ¨this._rangeçš„startå¤„</span></span><br><span class="line">        <span class="keyword">let</span> range = <span class="built_in">document</span>.createRange()</span><br><span class="line">        range.setStart(oldRange.startContainer, oldRange.startOffset)</span><br><span class="line">        range.setEnd(oldRange.startContainer, oldRange.startOffset)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">this</span>[RENDER_TO_DOM](range)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// é‡è®¾oldRangeçš„startèŠ‚ç‚¹ï¼Œè·³è¿‡æ’å…¥çš„range</span></span><br><span class="line">        oldRange.setStart(range.endContainer, range.endOffset)</span><br><span class="line">        <span class="comment">// æ¸…é™¤oldRangeçš„å†…å®¹</span></span><br><span class="line">        oldRange.deleteContents()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// [RENDER_TO_DOM]æ–¹æ³•ä¿ç•™äº†this._range </span></span><br><span class="line">    [RENDER_TO_DOM] (range) &#123;</span><br><span class="line">        <span class="built_in">this</span>._range = range</span><br><span class="line">        <span class="built_in">this</span>.render()[RENDER_TO_DOM](range)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘ä»¬ç”¨<a target="_blank" rel="noopener" href="https://codepen.io/gaearon/pen/gWWZgR">TicTacToeçš„æœ€ç»ˆç»“æœ</a>éªŒè¯å†™å¥½çš„toyReactï¼Œè¿™é‡Œæˆ‘ç”¨äº†ä¹‹å‰æˆ‘è‡ªå­¦æ—¶å†™å¥½çš„ï¼Œå½“ç„¶è¦æ³¨æ„å‡½æ•°å¼ç»„ä»¶å½“å‰ä¸å¯ç”¨ï¼Œéœ€è¦æ”¹ä¸ºclasså£°æ˜ã€‚</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Component, ToyReact &#125; <span class="keyword">from</span> <span class="string">&#x27;./toy-react.js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Square ç»„ä»¶æ¸²æŸ“äº†ä¸€ä¸ªå•ç‹¬çš„ &lt;button&gt;</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Square</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="comment">// æ¥æ”¶çˆ¶ç»„ä»¶å‚æ•°</span></span><br><span class="line">            &lt;button className=<span class="string">&quot;square&quot;</span> onClick=&#123;<span class="function">() =&gt;</span> <span class="built_in">this</span>.props.onClick()&#125;&gt;</span><br><span class="line">                &#123;<span class="comment">/* ä½¿ç”¨çˆ¶ç»„ä»¶å‚æ•° */</span>&#125;</span><br><span class="line">                &#123;<span class="built_in">this</span>.props.value&#125;</span><br><span class="line">            &lt;/button&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Board ç»„ä»¶æ¸²æŸ“äº† 9 ä¸ªæ–¹å—</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Board</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">renderSquare</span>(<span class="params">i</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// return &lt;Square /&gt;;</span></span><br><span class="line">        <span class="comment">// å¢åŠ å‚æ•°ï¼Œä¿®æ”¹ä¸€ä¸‹ Square çš„ç‚¹å‡»äº‹ä»¶ç›‘å¬å‡½æ•°</span></span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;Square</span><br><span class="line">                <span class="comment">// ä» Game ç»„ä»¶ä¸­æ¥æ”¶ squares å’Œ onClick è¿™ä¸¤ä¸ª propsã€‚</span></span><br><span class="line">                value=&#123;<span class="built_in">this</span>.props.squares[i]&#125;</span><br><span class="line">                onClick=&#123;<span class="function">() =&gt;</span> <span class="built_in">this</span>.props.onClick(i)&#125;</span><br><span class="line">                /&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;div className=<span class="string">&quot;board-row&quot;</span>&gt;</span><br><span class="line">                    &#123;<span class="built_in">this</span>.renderSquare(<span class="number">0</span>)&#125;</span><br><span class="line">                    &#123;<span class="built_in">this</span>.renderSquare(<span class="number">1</span>)&#125;</span><br><span class="line">                    &#123;<span class="built_in">this</span>.renderSquare(<span class="number">2</span>)&#125;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">                &lt;div className=<span class="string">&quot;board-row&quot;</span>&gt;</span><br><span class="line">                    &#123;<span class="built_in">this</span>.renderSquare(<span class="number">3</span>)&#125;</span><br><span class="line">                    &#123;<span class="built_in">this</span>.renderSquare(<span class="number">4</span>)&#125;</span><br><span class="line">                    &#123;<span class="built_in">this</span>.renderSquare(<span class="number">5</span>)&#125;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">                &lt;div className=<span class="string">&quot;board-row&quot;</span>&gt;</span><br><span class="line">                    &#123;<span class="built_in">this</span>.renderSquare(<span class="number">6</span>)&#125;</span><br><span class="line">                    &#123;<span class="built_in">this</span>.renderSquare(<span class="number">7</span>)&#125;</span><br><span class="line">                    &#123;<span class="built_in">this</span>.renderSquare(<span class="number">8</span>)&#125;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Game ç»„ä»¶æ¸²æŸ“äº†å«æœ‰é»˜è®¤å€¼çš„ä¸€ä¸ªæ£‹ç›˜</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Game</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ç‚¹å‡»äº‹ä»¶</span></span><br><span class="line">    <span class="function"><span class="title">handleClick</span>(<span class="params">i</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// å†å²,ä¸¢å¼ƒstepNumberåçš„æ•°æ®</span></span><br><span class="line">        <span class="keyword">const</span> history = <span class="built_in">this</span>.state.history.slice(<span class="number">0</span>, <span class="built_in">this</span>.state.stepNumber + <span class="number">1</span>)</span><br><span class="line">        <span class="comment">// å½“å‰çŠ¶æ€</span></span><br><span class="line">        <span class="keyword">const</span> current = history[history.length - <span class="number">1</span>]</span><br><span class="line">        <span class="keyword">const</span> squares = current.squares.slice()</span><br><span class="line">        <span class="comment">// å½“æœ‰ç©å®¶èƒœå‡ºæ—¶ï¼Œæˆ–è€…æŸä¸ª Square å·²ç»è¢«å¡«å……æ—¶ï¼Œè¯¥å‡½æ•°ä¸åšä»»ä½•å¤„ç†ç›´æ¥è¿”å›</span></span><br><span class="line">        <span class="keyword">if</span> (calculateWinner(squares) || squares[i]) <span class="keyword">return</span></span><br><span class="line">        <span class="comment">// æ ¹æ®xIsNextåˆ¤æ–­</span></span><br><span class="line">        squares[i] = <span class="built_in">this</span>.state.xIsNext ? <span class="string">&quot;X&quot;</span> : <span class="string">&quot;O&quot;</span></span><br><span class="line">        <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">            history: history.concat([</span><br><span class="line">                &#123;</span><br><span class="line">                    squares: squares,</span><br><span class="line">                &#125;,</span><br><span class="line">            ]),</span><br><span class="line">            <span class="comment">// squares: squares,</span></span><br><span class="line">            <span class="comment">// æ›´æ–°æ—¶é—´æ­¥</span></span><br><span class="line">            stepNumber: history.length,</span><br><span class="line">            <span class="comment">// ç¿»è½¬xIsNext</span></span><br><span class="line">            xIsNext: !<span class="built_in">this</span>.state.xIsNext,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ›´æ–°çŠ¶æ€ stepNumber</span></span><br><span class="line">    <span class="function"><span class="title">jumpTo</span>(<span class="params">step</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">            stepNumber: step,</span><br><span class="line">            xIsNext: step % <span class="number">2</span> === <span class="number">0</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸º Game ç»„ä»¶æ·»åŠ æ„é€ å‡½æ•°ï¼Œä¿å­˜å†å²æ­¥éª¤åˆ—è¡¨</span></span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">props</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(props)</span><br><span class="line">        <span class="built_in">this</span>.state = &#123;</span><br><span class="line">            history: [</span><br><span class="line">                &#123;</span><br><span class="line">                    squares: <span class="built_in">Array</span>(<span class="number">9</span>).fill(<span class="literal">null</span>),</span><br><span class="line">                &#125;,</span><br><span class="line">            ],</span><br><span class="line">            <span class="comment">// æ­¥æ•°</span></span><br><span class="line">            stepNumber: <span class="number">0</span>,</span><br><span class="line">            <span class="comment">// å°† â€œXâ€ é»˜è®¤è®¾ç½®ä¸ºå…ˆæ‰‹æ£‹</span></span><br><span class="line">            xIsNext: <span class="literal">true</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// çŠ¶æ€å˜åŒ–ï¼Œä»å­ç»„ä»¶æå‡åˆ°çˆ¶ç»„ä»¶</span></span><br><span class="line">        <span class="comment">// å†å²</span></span><br><span class="line">        <span class="keyword">const</span> history = <span class="built_in">this</span>.state.history</span><br><span class="line">        <span class="comment">// å½“å‰çŠ¶æ€ï¼Œå°†ä»£ç ä»å§‹ç»ˆæ ¹æ®æœ€åä¸€æ¬¡ç§»åŠ¨æ¸²æŸ“ä¿®æ”¹ä¸ºæ ¹æ®å½“å‰ stepNumber æ¸²æŸ“</span></span><br><span class="line">        <span class="keyword">const</span> current = history[<span class="built_in">this</span>.state.stepNumber]</span><br><span class="line">        <span class="comment">// è®¡ç®—èƒœè€…</span></span><br><span class="line">        <span class="keyword">const</span> winner = calculateWinner(current.squares)</span><br><span class="line">        <span class="comment">// å†å²æ­¥éª¤æ˜ å°„ä¸ºä»£è¡¨æŒ‰é’®çš„ React å…ƒç´ ï¼Œç„¶åå¯ä»¥å±•ç¤ºå‡ºä¸€ä¸ªæŒ‰é’®çš„åˆ—è¡¨ï¼Œç‚¹å‡»è¿™äº›æŒ‰é’®ï¼Œå¯ä»¥â€œè·³è½¬â€åˆ°å¯¹åº”çš„å†å²æ­¥éª¤ã€‚</span></span><br><span class="line">        <span class="keyword">const</span> moves = history.map(<span class="function">(<span class="params">step, move</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> desc = move ? <span class="string">&quot;è·³è½¬è‡³ç¬¬&quot;</span> + move + <span class="string">&quot;æ­¥&quot;</span> : <span class="string">&quot;æ¸¸æˆé‡æ–°å¼€å§‹&quot;</span></span><br><span class="line">            <span class="keyword">return</span> (</span><br><span class="line">                <span class="comment">// ç»„ä»¶çš„ key å€¼å¹¶ä¸éœ€è¦åœ¨å…¨å±€éƒ½ä¿è¯å”¯ä¸€ï¼Œåªéœ€è¦åœ¨å½“å‰çš„åŒä¸€çº§å…ƒç´ ä¹‹å‰ä¿è¯å”¯ä¸€å³å¯</span></span><br><span class="line">                &lt;li key=&#123;move&#125;&gt;</span><br><span class="line">                    &lt;button onClick=&#123;<span class="function">() =&gt;</span> <span class="built_in">this</span>.jumpTo(move)&#125;&gt;&#123;desc&#125;&lt;/button&gt;</span><br><span class="line">                &lt;/li&gt;</span><br><span class="line">            )</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="comment">// çŠ¶æ€</span></span><br><span class="line">        <span class="keyword">let</span> status</span><br><span class="line">        <span class="comment">// åˆ¤æ–­æ˜¯å¦è·èƒœ</span></span><br><span class="line">        <span class="keyword">if</span> (winner) &#123;</span><br><span class="line">            status = <span class="string">&quot;èƒœè€…ï¼š&quot;</span> + winner</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            status = <span class="string">&quot;ä¸‹ä¸€æ­¥: &quot;</span> + (<span class="built_in">this</span>.state.xIsNext ? <span class="string">&quot;X&quot;</span> : <span class="string">&quot;O&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div className=<span class="string">&quot;game&quot;</span>&gt;</span><br><span class="line">                &lt;div className=<span class="string">&quot;game-board&quot;</span>&gt;</span><br><span class="line">                    &lt;Board</span><br><span class="line">                        <span class="comment">// ç»‘å®šå‚æ•°å’Œäº‹ä»¶</span></span><br><span class="line">                        squares=&#123;current.squares&#125;</span><br><span class="line">                        onClick=&#123;<span class="function">(<span class="params">i</span>) =&gt;</span> <span class="built_in">this</span>.handleClick(i)&#125;</span><br><span class="line">                        /&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">                &lt;div className=<span class="string">&quot;game-info&quot;</span>&gt;</span><br><span class="line">                    &lt;div&gt;&#123;status&#125;&lt;/div&gt;</span><br><span class="line">                    &lt;ol&gt;&#123;moves&#125;&lt;/ol&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ToyReact.render(<span class="xml"><span class="tag">&lt;<span class="name">Game</span> /&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">&quot;root&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ¤æ–­èƒœè€…</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">calculateWinner</span>(<span class="params">squares</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// è·èƒœçš„åºå·</span></span><br><span class="line">    <span class="keyword">const</span> lines = [</span><br><span class="line">        [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>],</span><br><span class="line">        [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>],</span><br><span class="line">        [<span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>],</span><br><span class="line">        [<span class="number">0</span>, <span class="number">3</span>, <span class="number">6</span>],</span><br><span class="line">        [<span class="number">1</span>, <span class="number">4</span>, <span class="number">7</span>],</span><br><span class="line">        [<span class="number">2</span>, <span class="number">5</span>, <span class="number">8</span>],</span><br><span class="line">        [<span class="number">0</span>, <span class="number">4</span>, <span class="number">8</span>],</span><br><span class="line">        [<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>],</span><br><span class="line">    ]</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; lines.length; i++) &#123;</span><br><span class="line">        <span class="keyword">const</span> [a, b, c] = lines[i]</span><br><span class="line">        <span class="comment">// æœ‰äººè·èƒœ</span></span><br><span class="line">        <span class="keyword">if</span> (squares[a] &amp;&amp; squares[a] === squares[b] &amp;&amp; squares[a] === squares[c]) &#123;</span><br><span class="line">            <span class="keyword">return</span> squares[a]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿˜æœ‰æ ·å¼ï¼Œ<code>main.html</code>ä¸­å¯¼å…¥<code>main.css</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;main.css&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;icon&quot;</span> <span class="attr">href</span>=<span class="string">&quot;favicon.ico&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>Tic tac toe<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;main.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>main.css</code>ä¸­çš„æ ·å¼</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">    <span class="attribute">font</span>: <span class="number">14px</span> <span class="string">&quot;Century Gothic&quot;</span>, Futura, sans-serif;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">ol</span>,</span><br><span class="line"><span class="selector-tag">ul</span> &#123;</span><br><span class="line">    <span class="attribute">padding-left</span>: <span class="number">30px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.board-row</span>:after &#123;</span><br><span class="line">    clear: both;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="attribute">display</span>: table;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.status</span> &#123;</span><br><span class="line">    <span class="attribute">margin-bottom</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.square</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#fff</span>;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#999</span>;</span><br><span class="line">    <span class="attribute">float</span>: left;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">24px</span>;</span><br><span class="line">    <span class="attribute">font-weight</span>: bold;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">34px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">34px</span>;</span><br><span class="line">    <span class="attribute">margin-right</span>: -<span class="number">1px</span>;</span><br><span class="line">    <span class="attribute">margin-top</span>: -<span class="number">1px</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">34px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.square</span><span class="selector-pseudo">:focus</span> &#123;</span><br><span class="line">    <span class="attribute">outline</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.kbd-navigation</span> <span class="selector-class">.square</span><span class="selector-pseudo">:focus</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#ddd</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.game</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">flex-direction</span>: row;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.game-info</span> &#123;</span><br><span class="line">    <span class="attribute">margin-left</span>: <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="è™šæ‹ŸDOMçš„åŸç†å’Œå…³é”®å®ç°"><a href="#è™šæ‹ŸDOMçš„åŸç†å’Œå…³é”®å®ç°" class="headerlink" title="è™šæ‹ŸDOMçš„åŸç†å’Œå…³é”®å®ç°"></a>è™šæ‹ŸDOMçš„åŸç†å’Œå…³é”®å®ç°</h1><p>ç°åœ¨ï¼Œæˆ‘ä»¬æ‹¥æœ‰äº†åŸºäºå®ä½“domçš„ToyReactï¼Œå¯å–œå¯è´º</p>
<p>âœ¿âœ¿ãƒ½(Â°â–½Â°)ãƒâœ¿</p>
<p>ä½†æ˜¯ï¼Œreactçš„æ ¸å¿ƒæ˜¯è™šæ‹Ÿdomï¼Œæ¯•ç«Ÿæœ‰äº†è™šæ‹Ÿdomï¼Œæˆ‘ä»¬çš„ç»„ä»¶åˆ·æ–°æ‰æ›´é«˜æ•ˆå˜›</p>
<p>é‚£ä¹ˆï¼Œæˆ‘ä»¬æ¥å®ç°è¿™ä¸ªåŠŸèƒ½å§</p>
<h2 id="1-å®ç°è™šæ‹Ÿdomæ ‘çš„åˆ›å»ºåŠæ¸²æŸ“"><a href="#1-å®ç°è™šæ‹Ÿdomæ ‘çš„åˆ›å»ºåŠæ¸²æŸ“" class="headerlink" title="1. å®ç°è™šæ‹Ÿdomæ ‘çš„åˆ›å»ºåŠæ¸²æŸ“"></a>1. å®ç°è™šæ‹Ÿdomæ ‘çš„åˆ›å»ºåŠæ¸²æŸ“</h2><p>è¦æ”¯æŒè™šæ‹Ÿdomï¼Œæˆ‘ä»¬éœ€è¦é‡æ„ElementWrapperã€TextWrapperä»¥åŠComponentï¼Œæ¯•ç«Ÿå®ƒä»¬é€šè¿‡rootè¿™ä¸€å®é™…domè¿›è¡Œæ¸²æŸ“å’Œæ›´æ–°ã€‚</p>
<h3 id="ä»€ä¹ˆæ˜¯è™šæ‹ŸDOM"><a href="#ä»€ä¹ˆæ˜¯è™šæ‹ŸDOM" class="headerlink" title="ä»€ä¹ˆæ˜¯è™šæ‹ŸDOM"></a>ä»€ä¹ˆæ˜¯è™šæ‹ŸDOM</h3><p>è™šæ‹ŸDOMæœ¬è´¨ä¸Šå…¶å®æ˜¯å¯¹çœŸå®DOMçš„ä¸€ç§æ˜ å°„å…³ç³»ã€‚å®ƒæ˜¯ä¸€ç§ä»¥å¯¹è±¡çš„å½¢æ€æ¥è¡¨ç¤ºçœŸå®å­˜åœ¨çš„DOMã€‚ä¸¾ä¸ªä¾‹å­:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">&quot;ul1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">name</span>=<span class="string">&quot;1&quot;</span>&gt;</span>world !<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">name</span>=<span class="string">&quot;2&quot;</span>&gt;</span>world !<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">name</span>=<span class="string">&quot;3&quot;</span>&gt;</span>world !<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„htmlä»£ç å¦‚æœä»¥è™šæ‹ŸDOMçš„å½¢æ€æ¥è¡¨ç¤ºçš„è¯, é‚£ä¹ˆå°±æ˜¯:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    type: <span class="string">&#x27;ul&#x27;</span>,</span><br><span class="line">  	props: &#123;      </span><br><span class="line">    	id: <span class="string">&#x27;ul1&#x27;</span></span><br><span class="line"> 	&#125;,</span><br><span class="line">	children: [</span><br><span class="line">		&#123; <span class="attr">type</span>: <span class="string">&#x27;li&#x27;</span>, <span class="attr">props</span>: &#123;<span class="attr">name</span>: <span class="string">&#x27;1&#x27;</span>&#125;, <span class="attr">children</span>: [<span class="string">&#x27;world !&#x27;</span>]&#125;,</span><br><span class="line">        &#123; <span class="attr">type</span>: <span class="string">&#x27;li&#x27;</span>, <span class="attr">props</span>: &#123;<span class="attr">name</span>: <span class="string">&#x27;2&#x27;</span>&#125;, <span class="attr">children</span>: [<span class="string">&#x27;world !&#x27;</span>]&#125;,</span><br><span class="line">        &#123; <span class="attr">type</span>: <span class="string">&#x27;li&#x27;</span>, <span class="attr">props</span>: &#123;<span class="attr">name</span>: <span class="string">&#x27;3&#x27;</span>&#125;, <span class="attr">children</span>: [<span class="string">&#x27;world !&#x27;</span>]&#125;,</span><br><span class="line">	]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹äºå…ƒç´ èŠ‚ç‚¹æ¥è¯´, è™šæ‹ŸDOMåº”è¯¥åŒ…å«ä¸‰æ ·ä¸œè¥¿:</p>
<ul>
<li>èŠ‚ç‚¹çš„ç±»å‹(æ¯”å¦‚div, span, p)</li>
<li>èŠ‚ç‚¹ä¸Šçš„props</li>
<li>èŠ‚ç‚¹çš„children</li>
</ul>
<p>ç„¶è€Œå¯¹äºæ–‡æœ¬èŠ‚ç‚¹æ¥è¯´, å®ƒçš„ç±»å‹æ˜¯å›ºå®šçš„, å”¯ä¸€ä¸åŒçš„å°±æ˜¯ä»–çš„å†…å®¹äº†, å› æ­¤å®ƒçš„è™šæ‹ŸDOMå°±æ¯”è¾ƒç®€å•äº†</p>
<ul>
<li>èŠ‚ç‚¹çš„ç±»å‹(text)</li>
<li>èŠ‚ç‚¹çš„å†…å®¹(content)</li>
</ul>
<p>é‚£ä¹ˆå¯¹åº”åˆ°ToyReactä¸­çš„ä»£ç ç‰‡æ®µåº”è¯¥æ˜¯<code>ElementWrapper</code> å’Œ <code>TextWrapper</code> è¿™ä¸¤ä¸ªç±»ã€‚</p>
<h3 id="1-1-ElementWrapperçš„vdomå®ç°"><a href="#1-1-ElementWrapperçš„vdomå®ç°" class="headerlink" title="1.1 ElementWrapperçš„vdomå®ç°"></a>1.1 ElementWrapperçš„vdomå®ç°</h3><p>åœ¨ElementWrapperä¸­æˆ‘ä»¬å¢åŠ <code>vdom</code>çš„get</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">get vdom () &#123;</span><br><span class="line">	<span class="keyword">return</span> &#123;</span><br><span class="line">    	type: <span class="built_in">this</span>.type,</span><br><span class="line">        props: <span class="built_in">this</span>.props,</span><br><span class="line">        <span class="comment">// æ‹¿åˆ°æ¯ä¸ªchildçš„vdom</span></span><br><span class="line">        children: <span class="built_in">this</span>.children.map(<span class="function"><span class="params">child</span> =&gt;</span> child.vdom)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨setAtrributeæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å­˜å‚¨äº†<code>this.props</code>ï¼Œè€Œåœ¨appendChildä¸­ï¼Œæˆ‘ä»¬å­˜å‚¨äº†<code>this.children</code>ã€‚è¿™ä¸¤ç§æ–¹æ³•çš„é€»è¾‘ï¼Œå’ŒComponentæœ‰é‡åˆï¼Œ<strong>æ‰€ä»¥ElementWrapperå’ŒTextWrapperå¯ä»¥ç»§æ‰¿Component</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ElementWrapper</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">type</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(type)</span><br><span class="line">        <span class="built_in">this</span>.type = type</span><br><span class="line">        <span class="comment">// åˆ›å»ºæ ¹å…ƒç´ </span></span><br><span class="line">        <span class="built_in">this</span>.root = <span class="built_in">document</span>.createElement(type)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å’Œ</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TextWrapper</span> <span class="keyword">extends</span> <span class="title">Component</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">content</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(content)</span><br><span class="line">        <span class="built_in">this</span>.content = content</span><br><span class="line">        <span class="built_in">this</span>.root = <span class="built_in">document</span>.createTextNode(content)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-2-TextWrapperçš„vdomå®ç°"><a href="#1-2-TextWrapperçš„vdomå®ç°" class="headerlink" title="1.2 TextWrapperçš„vdomå®ç°"></a>1.2 TextWrapperçš„vdomå®ç°</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">get vdom () &#123;</span><br><span class="line">	<span class="keyword">return</span> &#123;</span><br><span class="line">    	type: <span class="string">&quot;#text&quot;</span>,</span><br><span class="line">        content: <span class="built_in">this</span>.content</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-3-Componentçš„vdomå®ç°"><a href="#1-3-Componentçš„vdomå®ç°" class="headerlink" title="1.3 Componentçš„vdomå®ç°"></a>1.3 Componentçš„vdomå®ç°</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">get vdom () &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">this</span>.render().vdom</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-4-vdomåˆ°å®ä½“domçš„patch"><a href="#1-4-vdomåˆ°å®ä½“domçš„patch" class="headerlink" title="1.4 vdomåˆ°å®ä½“domçš„patch"></a>1.4 vdomåˆ°å®ä½“domçš„patch</h3><p>æˆ‘ä»¬ä¹‹å‰åœ¨ElementWrapperä¸­è®¾ç½®çš„setAtrributeå’ŒappendChildæ–¹æ³•ï¼Œå®é™…åˆ›å»ºäº†éœ€è¦æ¸²æŸ“çš„domï¼Œè€Œå®ç°vdomåˆ°å®ä½“domçš„patchçš„è¿‡ç¨‹ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•å¯ä»¥åˆ é™¤ï¼Œå…¶é€»è¾‘å¯ä»¥åˆå¹¶åˆ°<code>[RENDER_TO_DOM]</code>æ–¹æ³•ä¸­ã€‚ å› ä¸ºåŸºäºvdomï¼Œæ‰€ä»¥ä¿å­˜å®é™…domçš„<code>this.root</code>å±æ€§å¯ä»¥åˆ å»ï¼Œå®é™…domåªåœ¨<code>[RENDER_TO_DOM]</code>æ–¹æ³•ä¸­å­˜åœ¨</p>
<p>åœ¨åˆ é™¤setAtrributeå’ŒappendChildæ–¹æ³•ä¹‹åï¼Œ<strong>å› ä¸º get vdom çš„æ“ä½œåªè¿”å›äº†å¯¹è±¡ï¼Œå¹¶æ²¡æœ‰è¿”å›æ–¹æ³•ï¼Œæ— æ³•é‡ç»˜</strong>ï¼Œæ‰€ä»¥ElementWrapperå’ŒTextWrapperçš„get vdomçš„æ­£è§£åº”æ˜¯ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ElementWrapper</span></span><br><span class="line">get vdom () &#123;</span><br><span class="line">	<span class="built_in">this</span>.vchildren = <span class="built_in">this</span>.children.map(<span class="function"><span class="params">child</span> =&gt;</span> child.vdom)</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">this</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// TextWrapper</span></span><br><span class="line"><span class="function"><span class="title">constructor</span>(<span class="params">content</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(content);</span><br><span class="line">    <span class="built_in">this</span>.type = <span class="string">&#x27;#text&#x27;</span>;</span><br><span class="line">    <span class="built_in">this</span>.content = content;</span><br><span class="line">    <span class="built_in">this</span>.root = <span class="built_in">document</span>.createTextNode(content)</span><br><span class="line">&#125;</span><br><span class="line">get vdom () &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">this</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆï¼Œvdomçš„å¯¹è±¡å±æ€§ï¼Œå°±æ˜¯ElementWrapperå’ŒTextWrapperä¸­çš„å±æ€§ã€‚ä¸ªäººç†è§£ï¼Œè¿™é‡Œå°†æ•°æ®å’Œè¡Œä¸ºè¿›ä¸€æ­¥è§£è€¦ã€‚</p>
<h4 id="1-4-1-RENDER-TO-DOM-æ–¹æ³•ä¸­patchçš„å®ç°"><a href="#1-4-1-RENDER-TO-DOM-æ–¹æ³•ä¸­patchçš„å®ç°" class="headerlink" title="1.4.1  [RENDER_TO_DOM]æ–¹æ³•ä¸­patchçš„å®ç°"></a>1.4.1  [RENDER_TO_DOM]æ–¹æ³•ä¸­patchçš„å®ç°</h4><p>æˆ‘ä»¬æ¥ä¸‹æ¥å…ˆå°†æ³¨é‡Šæ‰çš„äºŒä¸ªæ–¹æ³•é‡æ–°è¡¥ä¸Š, å› ä¸º<code>setAttribute</code> å’Œ <code>appendChild</code>æ–¹æ³•éƒ½æ˜¯å¯¹å®DOMçš„æ“ä½œ, æ‰€ä»¥æˆ‘æ‰“ç®—æŠŠè¿™ä¸¤ä¸ª å‡½æ•°çš„å®ç°å…¨éƒ¨æ”¾åˆ° <code>RENDER_TO_DOM</code>å‡½æ•°ä¸­ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ElementWrapper</span></span><br><span class="line">[RENDER_TO_DOM] (range) &#123;</span><br><span class="line">	range.deleteContents()</span><br><span class="line">    </span><br><span class="line">	<span class="comment">// åˆ›å»ºå®ä½“domï¼Œroot</span></span><br><span class="line">    <span class="keyword">let</span> root = <span class="built_in">document</span>.createElement(<span class="built_in">this</span>.type)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// propså†…å®¹æŠ„å†™ï¼ŒsetAttributeé€»è¾‘çš„å®ç°</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> name <span class="keyword">in</span> <span class="built_in">this</span>.props) &#123;</span><br><span class="line">    </span><br><span class="line">    	<span class="keyword">let</span> value = <span class="built_in">this</span>.props[name]</span><br><span class="line">        </span><br><span class="line">    	<span class="keyword">if</span> (name.match(<span class="regexp">/^on([\s\S]+)/</span>))&#123;</span><br><span class="line">            root.addEventListener(<span class="built_in">RegExp</span>.$1.replace(<span class="regexp">/^[\s\S]/</span>, <span class="function"><span class="params">c</span> =&gt;</span> c.toLowerCase()), value)</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (name === <span class="string">&quot;className&quot;</span>)&#123;</span><br><span class="line">                root.setAttribute(<span class="string">&quot;class&quot;</span>, value)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                root.setAttribute(name, value)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// childrençš„å¤„ç†</span></span><br><span class="line">     <span class="keyword">for</span> (<span class="keyword">let</span> child <span class="keyword">of</span> <span class="built_in">this</span>.children) &#123;</span><br><span class="line">     	</span><br><span class="line">        <span class="keyword">let</span> childRange = <span class="built_in">document</span>.createRange()</span><br><span class="line">        <span class="comment">// å°†æ–°å¢çš„å…ƒç´ ç½®äºrangeæœ«å°¾</span></span><br><span class="line">        childRange.setStart(root, root.childNodes.length)</span><br><span class="line">        childRange.setEnd(root, root.childNodes.length)</span><br><span class="line">        child[RENDER_TO_DOM](childRange)</span><br><span class="line">     &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æŒ‚è½½ root</span></span><br><span class="line">    range.insertNode(root)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-5-ä¿®å¤bug"><a href="#1-5-ä¿®å¤bug" class="headerlink" title="1.5 ä¿®å¤bug"></a>1.5 ä¿®å¤bug</h3><p>ç°åœ¨ï¼Œæˆ‘ä»¬çš„vdomæ ‘å·²ç»å¯ä»¥å»ºèµ·æ¥å•¦~</p>
<p>ä¸è¿‡è¿˜æ˜¯ç•™äº†ä¸€äº›å°¾å·´ï¼Œç‰¹åˆ«åœ¨äºvchildrençš„å¤„ç†ä¸Šï¼Œè¿™éƒ¨åˆ†è¿˜éœ€è¦ä¼˜åŒ–ï¼Œéœ€è¦å»æ‰Componentçš„vchildren getter</p>
<p>å¯¹äºElementWrapperå’ŒTextWrapperï¼Œæˆ‘ä»¬éœ€è¦åœ¨åœ¨[RENDER_TO_DOM]æ–¹æ³•ä¸­ä¿å­˜ä¹‹å‰çš„range</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TextWrapper</span></span><br><span class="line">[RENDER_TO_DOM] (range) &#123;</span><br><span class="line">	<span class="built_in">this</span>._range = range</span><br><span class="line">    <span class="keyword">let</span> root = <span class="built_in">document</span>.createTextNode(<span class="built_in">this</span>.content)</span><br><span class="line">    range.deleteContents()</span><br><span class="line">    range.insertNode(root)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç”±äºElementWrapperå’ŒTextWrapperçš„[RENDER_TO_DOM]ä¾æ—§é‡‡ç”¨å…ˆåˆ é™¤rangeï¼Œå†æ¸²æŸ“this.rootçš„æ–¹å¼ï¼Œä¼šå¯¼è‡´ç©ºrangeè¢«åï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ä¼˜åŒ–[RENDER_TO_DOM]ã€‚è€Œ[RENDER_TO_DOM]çš„é€»è¾‘åœ¨ä¸åŒä½ç½®éƒ½æœ‰ä½¿ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬å•ç‹¬å°è£…ä¸€ä¸ª<code>repalceContent</code>æ–¹æ³•</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">replaceContent</span> (<span class="params">range, node</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å°†nodeæ’å…¥rangeï¼Œæ­¤æ—¶nodeåœ¨rangeçš„æœ€å‰ä½ç½®</span></span><br><span class="line">	range.insertNode(node)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// rangeæŒªåˆ°nodeä¹‹å</span></span><br><span class="line">    range.setStartAfter(node)</span><br><span class="line">    <span class="comment">// æ¸…ç©ºrange</span></span><br><span class="line">    range.deleteContents()</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// é‡è®¾rangeçš„ä½ç½®</span></span><br><span class="line">    range.setStartBefore(node)</span><br><span class="line">    range.setEndAfter(node)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘ä»¬æ¥æ”¹è¿›[RENDER_TO_DOM]ä¸­rangeçš„å¤„ç†</p>
<p>ç¬¬ä¸€éƒ¨åˆ†çš„forå¾ªç¯å…¶å®åšçš„å°±æ˜¯ <code>setAttribute</code> çš„äº‹æƒ…, å°†å±æ€§èµ‹å€¼åˆ°å…ƒç´ ä¸Š, ç¬¬äºŒéƒ¨åˆ†çš„forå¾ªç¯åšçš„äº‹æƒ…åˆ™æ˜¯é€šè¿‡é€’å½’çš„æ–¹å¼æ’å…¥child.</p>
<p>é‚£ä¹ˆå¦‚ä½•å°†è™šæ‹ŸDOMä¸å®DOMç»“åˆä¸€èµ·å‘¢ã€‚å…¶å®å¾ˆç®€å•, æˆ‘ä»¬é€šè¿‡éå†è™šæ‹Ÿçš„children, æ¥æ„é€ ä¸€é¢—è™šæ‹Ÿçš„æ ‘ã€‚æœ€ç»ˆå°†è¿™æ£µè™šæ‹Ÿçš„æ ‘è½¬åŒ–ä¸ºå®é™…çš„æ ‘ã€‚ é‚£ä¹ˆå¯¹åº”åˆ°ä»£ç ä¸Šåº”è¯¥å¦‚ä½•ä¿®æ”¹å‘¢ï¼Ÿ æˆ‘ä»¬è¿˜æ˜¯ä» Componentä¸­çš„ <code>RENDER_TO_DOM</code>ä¸»ä½“å‡½æ•°ä¸Šç€æ‰‹, æˆ‘ä»¬ä»”ç»†ç ”è¯»ä»¥ä¸‹ä»£ç , æˆ‘ä»¬å‘ç°è¿™è¾¹çš„children è¿˜æ˜¯å®é™…çš„children, å¹¶ä¸æ˜¯è™šæ‹Ÿçš„children, å› æ­¤æˆ‘ä»¬éœ€è¦åœ¨Componentç±»ä¸­å®šä¹‰ä¸€ä¸ªvchildrenã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">get</span> <span class="title">vchildren</span>() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.children.map(<span class="function"><span class="params">child</span> =&gt;</span> child.vdom)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åŒç†æˆ‘ä»¬éå†çš„æ—¶å€™å°±ç”¨vchildrenè¿›è¡Œéå†, è¿™æ ·æˆ‘ä»¬çš„è¿™é¢—æ ‘å°±æ˜¯è™šæ‹Ÿçš„æ ‘ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> child <span class="keyword">of</span> <span class="built_in">this</span>.vchildren) &#123;</span><br><span class="line">    <span class="keyword">const</span> childRange = <span class="built_in">document</span>.createRange();</span><br><span class="line">    childRange.setStart(root, root.childNodes.length);</span><br><span class="line">    childRange.setEnd(root, root.childNodes.length);</span><br><span class="line">    child[RENDER_TO_DOM](childRange);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®Œæ•´çš„è™šæ‹Ÿdomè¿™å—å®ç°çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TextWrapper</span></span><br><span class="line">[RENDER_TO_DOM] (range) &#123;</span><br><span class="line">	<span class="keyword">let</span> root = <span class="built_in">document</span>.createTextNode(<span class="built_in">this</span>.content)</span><br><span class="line">	<span class="built_in">this</span>._range = range</span><br><span class="line">    replaceContent(range, root)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ElementWrapper</span></span><br><span class="line">get vdom () &#123;</span><br><span class="line">    <span class="built_in">this</span>.vchildren = <span class="built_in">this</span>.children.map(<span class="function"><span class="params">child</span> =&gt;</span> child.vdom)</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">this</span></span><br><span class="line">&#125;</span><br><span class="line">[RENDER_TO_DOM] (range) &#123;</span><br><span class="line">	<span class="built_in">this</span>._range = range</span><br><span class="line">	<span class="comment">// é€šè¿‡replaceContentä»£æ›¿åˆå§‹æ—¶range.deleteContents()</span></span><br><span class="line">	<span class="comment">// range.deleteContents()</span></span><br><span class="line">	</span><br><span class="line">    <span class="keyword">let</span> root = <span class="built_in">document</span>.createElement(<span class="built_in">this</span>.type)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> name <span class="keyword">in</span> <span class="built_in">this</span>.props) &#123;</span><br><span class="line">    	<span class="keyword">let</span> value = <span class="built_in">this</span>.props[name]</span><br><span class="line">    	<span class="keyword">if</span> (name.match(<span class="regexp">/^on([\s\S]+)/</span>))&#123;</span><br><span class="line">            root.addEventListener(<span class="built_in">RegExp</span>.$1.replace(<span class="regexp">/^[\s\S]/</span>, <span class="function"><span class="params">c</span> =&gt;</span> c.toLowerCase()), value)</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (name === <span class="string">&quot;className&quot;</span>)&#123;</span><br><span class="line">                root.setAttribute(<span class="string">&quot;class&quot;</span>, value)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                root.setAttribute(name, value)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">     <span class="keyword">for</span> (<span class="keyword">let</span> child <span class="keyword">of</span> <span class="built_in">this</span>.vchildren) &#123;</span><br><span class="line">        <span class="keyword">let</span> childRange = <span class="built_in">document</span>.createRange()</span><br><span class="line">        childRange.setStart(root, root.childNodes.length)</span><br><span class="line">        childRange.setEnd(root, root.childNodes.length)</span><br><span class="line">        child[RENDER_TO_DOM](childRange)</span><br><span class="line">     &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å®Œæˆrootçš„æŒ‚è½½</span></span><br><span class="line">    replaceContent(range, root)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-vdomæ¯”å¯¹çš„å®ç°"><a href="#2-vdomæ¯”å¯¹çš„å®ç°" class="headerlink" title="2. vdomæ¯”å¯¹çš„å®ç°"></a>2. vdomæ¯”å¯¹çš„å®ç°</h2><p>åœ¨æ‹¥æœ‰äº†vdomæ ‘çš„åˆ›å»ºèƒ½åŠ›ä¹‹åï¼Œæˆ‘ä»¬çš„<code>rerender</code>å‡½æ•°å¯ä»¥é€€ä¼‘äº†ï¼Œä»£æ›¿å®ƒçš„æ˜¯vdomæ›´æ–°ï¼Œåœ¨ComponentåŸºç±»ä¸­å®ç°</p>
<p>åœ¨Componentçš„[RENDER_TO_DOM]æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å…ˆæ›´æ–°vdomï¼Œå†æ¸²æŸ“</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Component</span></span><br><span class="line">[RENDER_TO_DOM] (range) &#123;</span><br><span class="line">	<span class="comment">// ä¿å­˜rangeå’Œvdom</span></span><br><span class="line">    <span class="built_in">this</span>._range = range</span><br><span class="line">    <span class="comment">// ç”±äºthis.vdomæ˜¯getterï¼Œæ‰€ä»¥ä¼šé‡æ–°è°ƒç”¨ç»„ä»¶çš„renderæ–¹æ³•ï¼Œè¿”å›æ–°çš„vdomï¼Œå®ç°vdomæ›´æ–°</span></span><br><span class="line">    <span class="built_in">this</span>._vdom = <span class="built_in">this</span>.vdom</span><br><span class="line">    <span class="comment">// æ¸²æŸ“æ—§çš„vdom</span></span><br><span class="line">    <span class="built_in">this</span>._vdom[RENDER_TO_DOM](range)</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ä»€ä¹ˆæ˜¯Diffç®—æ³•"><a href="#ä»€ä¹ˆæ˜¯Diffç®—æ³•" class="headerlink" title="ä»€ä¹ˆæ˜¯Diffç®—æ³•"></a>ä»€ä¹ˆæ˜¯Diffç®—æ³•</h3><p>Diffç®—æ³•å…¶å®æ˜¯é€šè¿‡æ¯”å¯¹æ–°æ—§è™šæ‹ŸDOMæ ‘,ç„¶åå°†ä¸åŒçš„éƒ¨åˆ†æ¸²æŸ“åˆ°é¡µé¢ä¸­,ä»è€Œè¾¾åˆ°æœ€å°åŒ–æ›´æ–°DOMçš„ç›®çš„ã€‚</p>
<p>ä»¥ä¸‹å›¾DOMä¸ºä¾‹:</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/huxingyi1997/my_img/img/20220407083210.png" alt="DOM"></p>
<p>Diffç®—æ³•é‡‡ç”¨æŒ‰ç…§æ·±åº¦éå†è§„åˆ™éå†çš„, å› æ­¤éå†çš„è¿‡ç¨‹å¦‚ä¸‹:</p>
<ul>
<li><ol>
<li>å¯¹æ¯”èŠ‚ç‚¹1(æ²¡æœ‰å˜åŒ–)</li>
</ol>
</li>
<li><ol>
<li>å¯¹æ¯”èŠ‚ç‚¹2(æ²¡æœ‰å˜åŒ–)</li>
</ol>
</li>
<li><ol>
<li>å¯¹æ¯”èŠ‚ç‚¹4(æ²¡æœ‰å˜åŒ–)</li>
</ol>
</li>
<li><ol>
<li>å¯¹æ¯”èŠ‚ç‚¹5<code>(èŠ‚ç‚¹5è¢«ç§»é™¤, è®°å½•ä¸€ä¸ªåˆ é™¤çš„æ“ä½œ)</code></li>
</ol>
</li>
<li><ol>
<li>å¯¹æ¯”èŠ‚ç‚¹3(æ²¡æœ‰å˜åŒ–)</li>
</ol>
</li>
<li><ol>
<li>å¯¹æ¯”èŠ‚ç‚¹3çš„children<code>(æ–°å¢èŠ‚ç‚¹5, è®°å½•ä¸€ä¸ªæ–°å¢æ“ä½œ)</code></li>
</ol>
</li>
</ul>
<p>å› æ­¤åœ¨å®é™…æ¸²æŸ“çš„è¿‡ç¨‹ä¸­, ä¼šæ‰§è¡ŒèŠ‚ç‚¹5çš„åˆ é™¤å’Œæ–°å¢æ“ä½œ, å…¶ä½™èŠ‚ç‚¹ä¸ä¼šå‘ç”Ÿä»»ä½•å˜åŒ–ã€‚</p>
<p>Diffç®—æ³•åœ¨å‰é¢æˆ‘ä»¬å·²ç»ç¨å¾®ä»‹ç»è¿‡äº†, æˆ‘ä»¬ä¸ä¼šè·ŸReactä¸€æ ·å»å®ç°ä»–çš„diffç®—æ³•, å› ä¸ºè¿™ä¸æ˜¯æœ¬æ–‡çš„é‡ç‚¹ã€‚æœ¬æ–‡çš„é‡ç‚¹æ—¨åœ¨è®©å¤§å®¶ç†è§£Diffç®—æ³•æ˜¯å¦‚ä½•è´¯ç©¿äºè™šæ‹ŸDOMçš„ã€‚ä½†æ˜¯æˆ‘ä»¬ä¼šå°½å¯èƒ½çš„å¤šè€ƒè™‘Diffé‡ç»˜çš„æƒ…å†µã€‚é‚£ä¹ˆå“ªå‡ ç§æƒ…å†µä¼šå¯¼è‡´æˆ‘ä»¬çš„DOMæ ‘é‡ç»˜åˆ¶å‘¢?</p>
<ul>
<li>èŠ‚ç‚¹çš„ç±»å‹ä¸åŒ</li>
</ul>
<p><img data-src="https://cdn.jsdelivr.net/gh/huxingyi1997/my_img/img/20220406223503.png" alt="èŠ‚ç‚¹çš„ç±»å‹ä¸åŒ"></p>
<ul>
<li>æ–°è€èŠ‚ç‚¹çš„propså€¼ä¸åŒ</li>
</ul>
<p><img data-src="https://cdn.jsdelivr.net/gh/huxingyi1997/my_img/img/20220407132424.png" alt="æ–°è€èŠ‚ç‚¹çš„propså€¼ä¸åŒ"></p>
<ul>
<li>æ–°èŠ‚ç‚¹çš„propså°‘äºè€èŠ‚ç‚¹çš„props</li>
</ul>
<p><img data-src="https://cdn.jsdelivr.net/gh/huxingyi1997/my_img/img/20220407133433.png" alt="æ–°èŠ‚ç‚¹çš„propså°‘äºè€èŠ‚ç‚¹çš„props"></p>
<ul>
<li>æ–‡æœ¬èŠ‚ç‚¹çš„å†…å®¹ä¸åŒ</li>
</ul>
<p><img data-src="https://cdn.jsdelivr.net/gh/huxingyi1997/my_img/img/20220407133532.png" alt="æ–‡æœ¬èŠ‚ç‚¹çš„å†…å®¹ä¸åŒ"></p>
<h3 id="2-1-vdomæ›´æ–°"><a href="#2-1-vdomæ›´æ–°" class="headerlink" title="2.1 vdomæ›´æ–°"></a>2.1 vdomæ›´æ–°</h3><p>åœ¨Componentçš„unpdateæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å®ç°vdomçš„æ›´æ–°ã€‚æˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯éå†æˆ‘ä»¬çš„è™šæ‹ŸDOMæ ‘.é¦–å…ˆåˆ¤æ–­æ–°çš„è™šæ‹ŸDOMèŠ‚ç‚¹ä¸è€çš„è™šæ‹ŸDOMèŠ‚ç‚¹ æ˜¯å¦ä¸€æ ·, å¦‚æœä¸€æ ·é‚£ä¹ˆå°±ç›´æ¥æ›¿æ¢<code>range</code>, å¹¶ä¸”é€šè¿‡é€’å½’çš„æ–¹å¼å»æ¯”å¯¹å­èŠ‚ç‚¹ã€‚ å¦‚æœèŠ‚ç‚¹ä¸ä¸€æ ·, é‚£ä¹ˆå°±æ›´æ–°å½“å‰èŠ‚ç‚¹ä¸‹çš„range, ä»è€Œè¾¾åˆ°éƒ¨åˆ†æ›´æ–°çš„æ•ˆæœã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">update () &#123;</span><br><span class="line">	 <span class="keyword">let</span> update = <span class="function">(<span class="params">oldNode, newNode</span>) =&gt;</span> &#123;</span><br><span class="line">     <span class="comment">// æ›´æ–°ä¸ºnewNode</span></span><br><span class="line">     &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä¿å­˜æ–°çš„vdom</span></span><br><span class="line">    <span class="keyword">let</span> vdom = <span class="built_in">this</span>.vdom</span><br><span class="line">    <span class="comment">// å¯¹æ¯”vdom</span></span><br><span class="line">    update(<span class="built_in">this</span>._vdom, vdom)</span><br><span class="line">    <span class="comment">// é‡æ–°èµ‹å€¼</span></span><br><span class="line">    <span class="built_in">this</span>._vdom = vdom</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆåœ¨å®ç°æ›´æ–°vdomåŠŸèƒ½å‰ï¼Œæˆ‘ä»¬éœ€è¦å¯¹æ¯”æ ¹èŠ‚ç‚¹ï¼Œç»†åŒ–vdomæ›´æ–°èŒƒå›´ã€‚</p>
<h3 id="2-2-ç®€å•çš„-dom-diff-ç®—æ³•"><a href="#2-2-ç®€å•çš„-dom-diff-ç®—æ³•" class="headerlink" title="2.2 ç®€å•çš„ dom diff ç®—æ³•"></a>2.2 ç®€å•çš„ dom diff ç®—æ³•</h3><p>æˆ‘ä»¬çš„èŠ‚ç‚¹æ›´æ–°é€»è¾‘å¦‚ä¸‹ï¼š</p>
<ul>
<li>æ ¹èŠ‚ç‚¹çš„typeæ˜¯å¦ä¸€è‡´ï¼Œä¸ä¸€è‡´ï¼Œåˆ™æ›´æ–°ä¸ºæ–°çš„æ ¹èŠ‚ç‚¹</li>
<li>æ ¹èŠ‚ç‚¹çš„propsæ˜¯å¦ä¸€è‡´ï¼Œä¸ä¸€è‡´ï¼Œåˆ™æ›´æ–°ä¸ºæ–°çš„æ ¹èŠ‚ç‚¹</li>
<li>æ ¹èŠ‚ç‚¹çš„childrenæ˜¯å¦ä¸€è‡´ï¼Œä¸ä¸€è‡´ï¼Œåˆ™æ›´æ–°ä¸ºæ–°çš„æ ¹èŠ‚ç‚¹</li>
<li>å¯¹äºæ–‡æœ¬èŠ‚ç‚¹ï¼Œcontentä¸ä¸€è‡´ï¼Œåˆ™æ›´æ–°ä¸ºæ–°èŠ‚ç‚¹</li>
</ul>
<p>æˆ‘ä»¬é‡‡ç”¨<del>æœ€åœŸï¼Œæœ€å‚»ç“œ</del>æœ€ç®€ç»ƒçš„æ–¹å¼æ›´æ–°dom</p>
<ul>
<li>åªå¯¹æ¯”ç›¸åŒä½ç½®çš„vdom</li>
<li>é‡‡ç”¨ç›´æ¥æ›¿æ¢çš„æ–¹å¼æ›´æ–°èŠ‚ç‚¹</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">update () &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">let</span> isSameNode = <span class="function">(<span class="params">oldNode, newNode</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// typeä¸åŒï¼Œåˆ™ä¸ºä¸åŒèŠ‚ç‚¹</span></span><br><span class="line">		<span class="keyword">if</span> (oldNode.type !== newNode.type) &#123;</span><br><span class="line">    		<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    	&#125;</span><br><span class="line">    </span><br><span class="line">    	<span class="comment">// propsä¸åŒï¼Œåˆ™ä¸ºä¸åŒèŠ‚ç‚¹</span></span><br><span class="line">    	<span class="keyword">for</span> (<span class="keyword">let</span> name <span class="keyword">in</span> newNode.props) &#123;</span><br><span class="line">    		<span class="comment">// å±æ€§å€¼è¦ç›¸åŒ</span></span><br><span class="line">        	<span class="keyword">if</span> (newNode.props[name] !== oldNode.props[name]) &#123;</span><br><span class="line">        		<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        	&#125;</span><br><span class="line">    	&#125;</span><br><span class="line">    	<span class="comment">// propsçš„é•¿åº¦ä¸ç›¸åŒï¼ŒèŠ‚ç‚¹ä¸ç›¸åŒ</span></span><br><span class="line">    	<span class="keyword">if</span> (<span class="built_in">Object</span>.keys(oldNode.props).length &gt; <span class="built_in">Object</span>.keys(newNode.props)) &#123;</span><br><span class="line">    		<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    	&#125;</span><br><span class="line">    </span><br><span class="line">    	<span class="comment">// æ–‡æœ¬èŠ‚ç‚¹ï¼Œæ¯”å¯¹content</span></span><br><span class="line">    	<span class="keyword">if</span> (newNode.type === <span class="string">&quot;#text&quot;</span>) &#123;</span><br><span class="line">    		<span class="keyword">if</span> (newNode.content !== oldNode.content) &#123;</span><br><span class="line">    			<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    		&#125;</span><br><span class="line">    	&#125;</span><br><span class="line">    </span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> update = <span class="function">() =&gt;</span> &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä¿å­˜æ–°çš„vdom</span></span><br><span class="line">    <span class="keyword">let</span> vdom = <span class="built_in">this</span>.vdom</span><br><span class="line">    <span class="comment">// å¯¹æ¯”vdom</span></span><br><span class="line">    update(<span class="built_in">this</span>._vdom, vdom)</span><br><span class="line">    <span class="comment">// é‡æ–°èµ‹å€¼</span></span><br><span class="line">    <span class="built_in">this</span>._vdom = vdom</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿˜å·®æœ€åä¸€æ­¥, æ¯æ¬¡æ›´æ–°å, è¿˜éœ€è¦å°†è™šæ‹ŸDOMæ ‘ä¹Ÿæ›´æ–°, ä¸ºä¸‹æ¬¡Diffåšå‡†å¤‡ã€‚æˆ‘ä»¬å®šä¹‰ä¸€ä¸ª<code>vdom</code> æ¥æ¥æ”¶æœ€æ–°çš„è™šæ‹ŸDOMæ ‘, æ‰§è¡Œå®Œæ›´æ–°è™šæ‹Ÿçš„å‡½æ•°å, æˆ‘ä»¬éœ€è¦å°†è€çš„è™šæ‹Ÿdomæ ‘(this._vdom)æ¢æˆæ›´æ–°å®Œå çš„è™šæ‹Ÿdomæ ‘ã€‚è‡³æ­¤æ•´ä¸ªæ›´æ–°æµç¨‹å°±å®Œæˆäº†, æˆ‘ä»¬æ¥æŸ¥çœ‹ä¸€ä¸‹æœ€åçš„æ•ˆæœã€‚</p>
<h3 id="2-3-newNodeæ›´æ–°"><a href="#2-3-newNodeæ›´æ–°" class="headerlink" title="2.3 newNodeæ›´æ–°"></a>2.3 newNodeæ›´æ–°</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">update () &#123;</span><br><span class="line">	<span class="keyword">let</span> isSameNode = <span class="function">(<span class="params">oldNode, newNode</span>) =&gt;</span> &#123;</span><br><span class="line">    	... ...</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">let</span> update = <span class="function">(<span class="params">oldNode, newNode</span>) =&gt;</span> &#123;</span><br><span class="line">    </span><br><span class="line">    	<span class="comment">// æ ¹èŠ‚ç‚¹ä¸åŒï¼Œåˆ™å…¨éƒ¨é‡æ–°æ¸²æŸ“</span></span><br><span class="line">    	<span class="keyword">if</span> (!isSameNode(oldNode, newNode)) &#123;</span><br><span class="line">        	<span class="comment">// æ›¿æ¢oldNode</span></span><br><span class="line">        	newNode[RENDER_TO_DOM](oldNode._range)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        newNode._range = oldNode._range</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// childrençš„å¤„ç†</span></span><br><span class="line">        <span class="comment">// å› ä¸ºchildrenå±æ€§æ˜¯å®ä½“domï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æ‹¿åˆ°vchildren</span></span><br><span class="line">        <span class="keyword">let</span> newChildren = newNode.vchildren</span><br><span class="line">        <span class="keyword">let</span> oldChildren = oldNode.vchildren</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!newChildren || !newChildren.length) &#123;</span><br><span class="line">        	<span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è®°å½•oldChildrençš„å°¾éƒ¨ä½ç½®</span></span><br><span class="line">        <span class="keyword">let</span> tailRange = oldChildren[oldChildren.length - <span class="number">1</span>]._range</span><br><span class="line">        <span class="comment">// ä¸¤ä¸ªæ•°ç»„ä¸€èµ·å¾ªç¯ï¼Œæ‰€ä»¥ä¸ç”¨ for ofå¾ªç¯</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; newChildren.length; i++) &#123;</span><br><span class="line">        	<span class="keyword">let</span> newChild = newChildren[i]</span><br><span class="line">            <span class="keyword">let</span> oldChild = oldChildren[i]</span><br><span class="line">            <span class="keyword">if</span> (i &lt; oldChildren.length) &#123;</span><br><span class="line">            	update(oldChild, newChild)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// å¦‚æœnewChildæ¯”oldChildå…ƒç´ å¤šï¼Œæˆ‘ä»¬éœ€è¦åœ¨newChildè¿›è¡ŒèŠ‚ç‚¹æ’å…¥</span></span><br><span class="line">                <span class="comment">// åˆ›å»ºä¸€ä¸ªéœ€è¦æ’å…¥çš„range</span></span><br><span class="line">                <span class="keyword">let</span> range = <span class="built_in">document</span>.createRange()</span><br><span class="line">                range.setStart(tailRange.endContainer, tailRange.endOffset)</span><br><span class="line">                range.setEnd(tailRange.endContainer, tailRange.endOffset)</span><br><span class="line">                newChild[RENDER_TO_DOM](range)</span><br><span class="line">                tailRange = range</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> vdom = <span class="built_in">this</span>.vdom</span><br><span class="line">    <span class="comment">// æ›´æ–°vdom</span></span><br><span class="line">    update(<span class="built_in">this</span>._vdom, vdom)</span><br><span class="line">    <span class="comment">// é‡æ–°èµ‹å€¼, æ­¤æ—¶çš„â€œæ—§vdomâ€æ˜¯vdom</span></span><br><span class="line">    <span class="built_in">this</span>._vdom = vdom</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¹‹ååœ¨setStateä¸­è°ƒç”¨updateï¼Œå³å¯å®ç°è™šæ‹Ÿdomçš„æ›´æ–°ã€‚</p>
<p>è‡³æ­¤ï¼Œå¡‘æ–™ç‰ˆreact toyReactå°±å®Œæˆå•¦âœ¿âœ¿ãƒ½(Â°â–½Â°)ãƒâœ¿</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/huxingyi1997/my_img/img/20220407173725.gif" alt="å¡‘æ–™ç‰ˆToyReactä½¿ç”¨"></p>
<p>æˆ‘ä»¬å‘ç°DOMæ ‘å·²ç»ä¸å†æ˜¯é‡å¤´ç»˜åˆ¶äº†ã€‚å®ƒçš„æ›´æ–°èŒƒå›´å·²ç»ç¼©å°åœ¨äº† <code>Board</code> ç±»å¯¹åº”çš„DOMæ ‘èŒƒå›´å†…äº†ã€‚ ä½†æ˜¯è¿™è¾¹æœ‰ä¸€ä¸ªå°é—®é¢˜ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸èƒ½å•ä¸ªbuttonæ ¼å­æ›´æ–°å‘¢ï¼Ÿæˆ‘æ‰“ç®—ç”¨debugçš„æ–¹å¼æ¥è¯´æ˜è¿™ä¸ªé—®é¢˜ã€‚ é¦–å…ˆï¼Œåœ¨ <code>isSameNode</code> å‡½æ•°ä¸Šæ‰“ä¸€ä¸ªæ–­ç‚¹ï¼Œæ–¹ä¾¿æˆ‘ä»¬è°ƒè¯•.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> isSameNode = <span class="function">(<span class="params">oldNode, newNode</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">debugger</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(oldNode.type !== newNode.type) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> newNode.props) &#123;</span><br><span class="line">        <span class="keyword">if</span> (oldNode.props[key] !== newNode.props[key]) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">Object</span>.keys(oldNode.props).length &gt;  <span class="built_in">Object</span>.keys(newNode.props).length)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(newNode.type === <span class="string">&quot;#text&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(newNode.content !== oldNode.content) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç‚¹å‡»å·¦ä¸Šæ–¹çš„æ ¼å­ï¼Œæ‰“å¼€æµè§ˆå™¨è°ƒè¯•æ¨¡å¼ï¼Œç¨‹åºå³å¯è¿›å…¥debuggeræ¨¡å¼ã€‚æˆ‘ä»¬ç›´æ¥è¿›å…¥åˆ°æœ€åä¸€æ¬¡æ¯”è¾ƒæ ¼å­çš„åœ°æ–¹ã€‚</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/huxingyi1997/my_img/img/20220407174623.png" alt="oldNode"></p>
<p>è€çš„è™šæ‹ŸDOMçš„<code>content</code> æ˜¯ç©ºå€¼ï¼ŒæŒ‰ç…§æ­£å¸¸é€»è¾‘æ­¤æ—¶çš„å¯¹åº”çš„æ–°çš„è™šæ‹ŸDOMä¸­çš„contentå€¼åº”è¯¥æ˜¯ä¸€ä¸ª<code>x</code>ã€‚æˆ‘ä»¬æ¥æ ¡éªŒä¸€ä¸‹ç»“æœã€‚</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/huxingyi1997/my_img/img/20220407175146.png" alt="newNode"></p>
<p>OKï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¥ä¸‹å»éœ€è¦çŸ¥é“çš„æ˜¯ï¼Œå®ƒæ˜¯åœ¨æ¯”è¾ƒä»€ä¹ˆåœ°æ–¹çš„æ—¶å€™ï¼Œå‡ºç°äº†ä¸åŒï¼Œå¯¼è‡´é‡ç»˜çš„ã€‚æˆ‘ä»¬å‘ç°åœ¨æ¯”å¯¹æ–°è€èŠ‚ç‚¹çš„propsçš„æ—¶å€™ï¼Œå‘ç”Ÿäº†å€¼ä¸ä¸€æ ·çš„æƒ…å†µã€‚è€Œä¸ä¸€æ ·çš„keyï¼Œæ˜¯ <code>onClick </code>ã€‚</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/huxingyi1997/my_img/img/20220407180207.png" alt="onClickå¯¼è‡´é‡ç»˜"></p>
<p>è°ƒè¯•åˆ°è¿™é‡Œæˆ‘ä»¬åº”è¯¥æ˜ç™½äº†ä¸ºä»€ä¹ˆå®ƒé‡ç»˜çš„åŒºåŸŸä¸æˆ‘ä»¬æƒ³è±¡çš„ä¸ä¸€æ ·äº†ã€‚åœ¨æ¯”å¯¹äº‹ä»¶çš„æ—¶å€™, æˆ‘ä»¬æ¯æ¬¡éƒ½ä¼šå®ä¾‹åŒ–ä¸€ä¸ªæ–°çš„äº‹ä»¶å‡½æ•°ã€‚è¿™å°±å¯¼è‡´äº†æˆ‘ä»¬çš„ToyReactå¤„ç†ä¸äº†å…³äºäº‹ä»¶è°ƒåº¦æ–¹é¢çš„diffäº†ã€‚é‚£ä¹ˆå¦‚æœæƒ³è¦è¾¾åˆ°Reacté‚£æ ·, åªæ›´æ–°æŸä¸ªèŠ‚ç‚¹ è¿™æ ·çš„æ•ˆæœçš„è¯, æˆ‘ä»¬å¯ä»¥é‡‡å–æœ€æ®‹æš´çš„æ‰‹æ³•, ç›´æ¥å¿½ç•¥æ‰€æœ‰çš„äº‹ä»¶ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> newNode.props) &#123;</span><br><span class="line">    <span class="keyword">if</span> (oldNode.props[key] !== newNode.props[key]) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">typeof</span> newNode.props[key] !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ç»§ç»­çœ‹çœ‹, æœ€åçš„æ•ˆæœå¦‚ä½•?</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/huxingyi1997/my_img/img/20220407180613.gif" alt="å¿½ç•¥æ‰€æœ‰çš„äº‹ä»¶"></p>
<p>It is Cool! æˆ‘ä»¬ä¹Ÿåšåˆ°äº†åªæ›´æ–°æŸä¸ªèŠ‚ç‚¹çš„æ•ˆæœäº†ã€‚ ä¸è¿‡å¤§å®¶ä¹å‘µä¹å‘µå°±è¡Œ, å­¦æŠ€æœ¯è¿˜æ˜¯å¾—çœ‹Reactå®˜æ–¹æºç , å“ˆå“ˆã€‚</p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>å€ŸåŠ©webpackï¼Œæˆ‘ä»¬å®ç°äº†ToyReactï¼Œä¸€ä¸ªå¡‘æ–™reactğŸ¶</p>
<h2 id="1-JSX-è¯­æ³•è§£æ"><a href="#1-JSX-è¯­æ³•è§£æ" class="headerlink" title="1. JSX è¯­æ³•è§£æ"></a>1. JSX è¯­æ³•è§£æ</h2><p>JSX æ˜¯ JavaScript ä¸ XML ç›¸ç»“åˆçš„ä¸€ç§æ ¼å¼ã€‚Reactå‘æ˜äº†JSXï¼Œå®ç°äº†åˆ©ç”¨HTML è¯­æ³•æ¥åˆ›å»ºè™šæ‹ŸDOMã€‚é‡åˆ°<code>&lt;</code>æ—¶ï¼ŒJSXå°†èµ·ä½œä¸ºHTMLè§£æï¼Œé‡åˆ° <code>&#123;</code>JSXå°†å…¶ä½œä¸ºJavaScriptè§£æã€‚</p>
<p><strong>JSXè¯­æ³•å¹¶ä¸æ˜¯ç›´æ¥æŠŠJSXæ¸²æŸ“åˆ°é¡µé¢</strong>ï¼Œè€Œæ˜¯åœ¨Reactå†…éƒ¨å…ˆå°†JSXè½¬æ¢æˆcreateElementå½¢å¼ï¼Œå†å»æ¸²æŸ“çš„ï¼ŒåŒæ—¶JSXåœ¨ç¼–è¯‘æˆJavaScriptä»£ç çš„æ—¶å€™è¿›è¡Œäº†ä¸€å®šçš„ä¼˜åŒ–ï¼Œä¿è¯äº†Reactçš„æ›´é«˜æ‰§è¡Œæ•ˆç‡ã€‚</p>
<p>åœ¨ToyReactä¸­ï¼Œæˆ‘ä»¬é€šè¿‡è®¾ç½®webpackçš„ ** @babel/plugin-transform-react-jsx** æ’ä»¶ï¼Œé‡æ–°å®šä¹‰äº†jsxç”Ÿæˆdomçš„å‡½æ•°ï¼ˆå¹¶æ²¡æœ‰å®ç°jsxè¯­æ³•æœ¬èº«ï¼‰</p>
<p>â†“â†“â†“ webpack é…ç½®å¦‚ä¸‹ â†“â†“â†“</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">                use: &#123;</span><br><span class="line">                    loader: <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">                    <span class="comment">// é…ç½®babel-loader</span></span><br><span class="line">                    options: &#123;</span><br><span class="line">                        presets: [<span class="string">&#x27;@babel/preset-env&#x27;</span>],</span><br><span class="line">                        <span class="comment">// è¿™æ ·æ‰“åŒ…åçš„â€˜React.createElementå°±ä¼šå˜æˆâ€˜createElementâ€™</span></span><br><span class="line">                        <span class="comment">// æˆ‘ä»¬å®šä¹‰çš„ createElement å‡½æ•°å°†ä¼šè¦†ç›– React.createElement æ–¹æ³•</span></span><br><span class="line">                        plugins: [[<span class="string">&#x27;@babel/plugin-transform-react-jsx&#x27;</span>, &#123;<span class="attr">pragma</span>: <span class="string">&#x27;ToyReact.createElement&#x27;</span>&#125;]]</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-ToyReactç”Ÿå‘½å‘¨æœŸ"><a href="#2-ToyReactç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="2. ToyReactç”Ÿå‘½å‘¨æœŸ"></a>2. ToyReactç”Ÿå‘½å‘¨æœŸ</h2><p>åœ¨Component classé‡Œæœ‰ <a href="https://link.juejin.cn/?target=">RENDER_TO_DOM</a> å’Œ update() ä¸¤ä¸ªå‡½æ•°ï¼Œå¯¹åº”Reactç”Ÿå‘½å‘¨æœŸï¼Œå°±æ˜¯åœ¨<strong>æŒ‚è½½å‰</strong>éœ€è¦çš„æ“ä½œå’Œ<strong>æ›´æ–°</strong>æ—¶éœ€è¦çš„æ“ä½œã€‚</p>
<p>åœ¨<strong>æŒ‚è½½</strong>ä¹‹å‰ï¼šé€šè¿‡setAttributeæ·»åŠ è‡ªå®šä¹‰çš„å±æ€§ï¼ŒaddEventListeneræ·»åŠ äº‹ä»¶ï¼›ç„¶åå°±ä¼šæ‰§è¡Œä¸€æ¬¡render</p>
<p>å¦‚æœæœ‰<strong>æ›´æ–°</strong>æ“ä½œï¼Œå°±ä¼šåœ¨update()å†…ä¼šé€šè¿‡å¯¹æ¯”å¯¹æ›´æ–°çš„å…ƒç´ è¿›è¡Œæ›¿æ¢ï¼›å†æ¬¡render</p>
<h3 id="Reactç”Ÿå‘½å‘¨æœŸå‡½æ•°"><a href="#Reactç”Ÿå‘½å‘¨æœŸå‡½æ•°" class="headerlink" title="Reactç”Ÿå‘½å‘¨æœŸå‡½æ•°"></a>Reactç”Ÿå‘½å‘¨æœŸå‡½æ•°</h3><ul>
<li><del>ç»„ä»¶å°†è¦æŒ‚è½½æ—¶è§¦å‘çš„å‡½æ•°ï¼šcomponentWillMount</del></li>
<li>ç»„ä»¶æŒ‚è½½å®Œæˆæ—¶è§¦å‘çš„å‡½æ•°ï¼šcomponentDidMount</li>
<li>æ˜¯å¦è¦æ›´æ–°æ•°æ®æ—¶è§¦å‘çš„å‡½æ•°ï¼šshouldComponentUpdate</li>
<li><del>å°†è¦æ›´æ–°æ•°æ®æ—¶è§¦å‘çš„å‡½æ•°ï¼šcomponentWillUpdate</del></li>
<li>æ•°æ®æ›´æ–°å®Œæˆæ—¶è§¦å‘çš„å‡½æ•°ï¼šcomponentDidUpdate</li>
<li>ç»„ä»¶å°†è¦é”€æ¯æ—¶è§¦å‘çš„å‡½æ•°ï¼šcomponentWillUnmount</li>
<li>çˆ¶ç»„ä»¶ä¸­æ”¹å˜äº†propsä¼ å€¼æ—¶è§¦å‘çš„å‡½æ•°ï¼š<del>componentWillReceiveProps</del></li>
</ul>
<h3 id="React16åºŸå¼ƒç”Ÿå‘½å‘¨æœŸ"><a href="#React16åºŸå¼ƒç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="React16åºŸå¼ƒç”Ÿå‘½å‘¨æœŸ"></a>React16åºŸå¼ƒç”Ÿå‘½å‘¨æœŸ</h3><p>React16åºŸå¼ƒäº†ä¸‰ä¸ªç”Ÿå‘½å‘¨æœŸï¼šcomponentWillMountã€componentWillReceivePropsã€componentWillUpdate</p>
<p>åºŸå¼ƒåŸå› ï¼šåœ¨React16çš„Fiberæ¶æ„ä¸­ï¼Œè°ƒå’Œè¿‡ç¨‹ä¼šå¤šæ¬¡æ‰§è¡Œwillå‘¨æœŸï¼Œä¸å†æ˜¯ä¸€æ¬¡æ‰§è¡Œï¼Œæ‰€ä»¥è¿™äº›å‘¨æœŸå¤±å»äº†åŸæœ‰çš„æ„ä¹‰ã€‚æ­¤å¤–ï¼Œç”±äºå‘¨æœŸä¼šå¤šæ¬¡æ‰§è¡Œï¼Œ åœ¨å‘¨æœŸä¸­è®¾ç½®setStateæˆ–domæ“ä½œï¼Œä¼šè§¦å‘å¤šæ¬¡é‡ç»˜ï¼Œå½±å“æ€§èƒ½ï¼Œä¹Ÿä¼šå¯¼è‡´æ•°æ®é”™ä¹±</p>
<p>componentWillMountå’ŒcomponentWillUpdateåœ¨æ¯ä¸€ä¸ªç»„ä»¶renderä¹‹å‰éƒ½ä¼šå»è°ƒç”¨componentWillMount()ï¼Œå¯ä»¥åœ¨æœåŠ¡ç«¯è°ƒç”¨ä¹Ÿå¯ä»¥åœ¨æµè§ˆå™¨ç«¯è°ƒç”¨ï¼Œ<strong>å¦‚æœæœ‰å¼‚æ­¥è¯·æ±‚ï¼Œä¸æ¨èåœ¨æ­¤æ—¶è¯·æ±‚æ•°æ®ï¼Œå› ä¸ºåœ¨renderå‰å¹¶ä¸ä¼šè¿”å›æ•°æ®</strong>ã€‚</p>
<p>componentWillUpdate()åœ¨ç»„ä»¶å°†è¦æ›´æ–°æ•°æ®çš„æ—¶å€™éƒ½ä¼šè§¦å‘ä¸€æ¬¡ï¼Œæ‰§è¡Œæ›´æ–°æ“ä½œã€‚</p>
<h3 id="React16æ–°å¢2ä¸ªç”Ÿå‘½å‘¨æœŸï¼š"><a href="#React16æ–°å¢2ä¸ªç”Ÿå‘½å‘¨æœŸï¼š" class="headerlink" title="React16æ–°å¢2ä¸ªç”Ÿå‘½å‘¨æœŸï¼š"></a>React16æ–°å¢2ä¸ªç”Ÿå‘½å‘¨æœŸï¼š</h3><ul>
<li>getDerivedStateFromPropsï¼š16.3æ˜¯åœ¨propså˜åŒ–æ—¶è§¦å‘ï¼Œ16.4åˆ™æ”¹ä¸ºåœ¨æ¯æ¬¡ç»„ä»¶æ¸²æŸ“å™¨è°ƒç”¨</li>
<li>getSnapshotBeforeUpdateï¼šåœ¨renderä¹‹åï¼Œæ›´æ–°DOMä¹‹å‰ï¼Œstateå·²æ›´æ–°</li>
</ul>
<p><strong>getDerivedStateFromProps</strong>å‘¨æœŸæœ‰äº›éš¾ç”¨ï¼š</p>
<ol>
<li>è§¦å‘æ—¶æœºé¢‘ç¹ï¼Œ16.3æ˜¯åœ¨propså˜åŒ–æ—¶è§¦å‘ï¼Œ16.4åˆ™æ”¹ä¸ºåœ¨æ¯æ¬¡ç»„ä»¶æ¸²æŸ“å™¨è°ƒç”¨ï¼Œ</li>
</ol>
<p>å³æ— è®ºpropså˜åŒ–ï¼Œç»„ä»¶è‡ªå·±setStateï¼Œçˆ¶ç»„ä»¶render éƒ½ä¼šè§¦å‘ 2. é™æ€æ–¹æ³•ï¼Œæœ¬æ„æ˜¯éš”ç¦»è®¿é—®ç»„ä»¶å®ä¾‹ï¼Œå´ä¼šé€ æˆè®¿é—®ç»„ä»¶çš„æ•°æ®å’Œæ–¹æ³•ååˆ†ä¸ä¾¿ï¼Œéš¾ä»¥è¿›è¡Œæ•°æ®æ¯”è¾ƒ 3. ä¸èƒ½setStateï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªå¯¹è±¡æ¥æ›´æ–°stateï¼Œä½¿ç”¨ä¸ä¾¿ï¼Œä¹Ÿå¯èƒ½è§¦å‘å¤šæ¬¡æ›´æ–°çŠ¶æ€</p>
<p><strong>getSnapshotBeforeUpdate</strong>å‘¨æœŸåœ¨Fiberæ¶æ„ä¸­ï¼Œåªä¼šè°ƒç”¨ä¸€æ¬¡ï¼Œå®ç°äº†ç±»ä¼¼willMountçš„æ•ˆæœã€‚å¯ä»¥ç”¨æ¥è¯»å–DOMï¼Œå¼ºåˆ¶ç”¨æˆ·åªèƒ½åœ¨mounté˜¶æ®µè¯»å–DOMã€‚</p>
<h2 id="3-ToyReactè™šæ‹ŸDOM"><a href="#3-ToyReactè™šæ‹ŸDOM" class="headerlink" title="3. ToyReactè™šæ‹ŸDOM"></a>3. ToyReactè™šæ‹ŸDOM</h2><p>Reactå°†DOMæŠ½è±¡ä¸ºè™šæ‹ŸDOMï¼Œç”¨JavaScriptæ¨¡æ‹Ÿä¸€é¢—DOMæ ‘ï¼Œæ”¾åœ¨æµè§ˆå™¨å†…å­˜ä¸­ã€‚å½“å˜æ›´æ—¶ï¼Œè™šæ‹ŸDOMä½¿ç”¨DIFFç®—æ³•è¿›è¡Œæ–°æ—§è™šæ‹ŸDOMçš„æ¯”è¾ƒï¼Œå°†å˜æ›´æ”¾åˆ°å˜æ›´é˜Ÿåˆ—ä¸­ï¼Œæœ€ç»ˆåªæŠŠå˜åŒ–çš„éƒ¨åˆ†é‡æ–°æ¸²æŸ“ï¼Œä»è€Œæé«˜æ¸²æŸ“æ•ˆç‡ã€‚</p>
<p>åœ¨éœ€è¦<strong>é¢‘ç¹å¾®æ”¹åŠ¨DOMæ—¶</strong>ï¼Œç›´æ¥ä¿®æ”¹DOMä¼šå¼•èµ·é¡µé¢çš„å¤šæ¬¡æ¸²æŸ“ï¼Œå½±å“æ€§èƒ½ã€‚è€Œä½¿ç”¨è™šæ‹ŸDOMçš„æ—¶å€™ï¼Œå…ˆå¯¹æ¯”å·®å¼‚ï¼Œå†ä¿®æ”¹JSå¯¹è±¡(ç”Ÿæˆè™šæ‹ŸDOM)ï¼Œæœ€åæŠŠç”Ÿæˆçš„DOMç»“æ„æ’å…¥åˆ°é¡µé¢ä¸­ï¼Œä»è€Œå‡å°‘æ¸²æŸ“æ¬¡æ•°ï¼Œæå‡æ•´ä¸ªé¡µé¢çš„æ¸²æŸ“æ•ˆç‡ã€‚</p>
<h3 id="Range"><a href="#Range" class="headerlink" title="Range"></a>Range</h3><p>ToyReactçš„è™šæ‹ŸDOMå®ç°ï¼Œå€ŸåŠ©äº†Rangeå¯¹è±¡</p>
<p>Rangeå¯¹è±¡è¡¨ç¤ºæ–‡æ¡£çš„è¿ç»­èŒƒå›´åŒºåŸŸï¼Œç›¸å½“äº<strong>é«˜äº®é€‰åŒº</strong>ã€‚ä¸€ä¸ªRangeçš„å¼€å§‹ç‚¹å’Œç»“æŸç‚¹å¯ä»¥æ˜¯ä»»æ„çš„ï¼Œå¼€å§‹ç‚¹å’Œç»“æŸç‚¹ä¹Ÿå¯ä»¥æ˜¯ä¸€æ ·çš„(ç©ºRange)</p>
<p>Rangeçš„åº”ç”¨å¸¸è§äºå¯Œæ–‡æœ¬ç¼–è¾‘å™¨çš„ç›¸å…³æ“ä½œ</p>
<p>ä½¿ç”¨Rangeæ—¶ï¼Œé¦–å…ˆä¼šåˆ›å»ºä¸€ä¸ªrangeå¯¹è±¡(createRange)ï¼Œå°†æŒ‡å®šèŠ‚ç‚¹çš„ç»ˆç‚¹ä½ç½®æŒ‡å®šä¸ºRangeå¯¹è±¡æ‰€ä»£è¡¨åŒºåŸŸçš„èµ·ç‚¹ä½ç½®(setStartAfter)ï¼›ç´§æ¥ç€å°†æŒ‡å®šçš„èŠ‚ç‚¹æ’å…¥åˆ°æŸä¸ªRangeå¯¹è±¡æ‰€ä»£è¡¨çš„åŒºåŸŸä¸­ï¼Œæ’å…¥ä½ç½®ä¸ºRangeå¯¹è±¡æ‰€ä»£è¡¨åŒºåŸŸçš„èµ·ç‚¹ä½ç½®ï¼Œå¦‚æœè¯¥èŠ‚ç‚¹å·²ç»å­˜åœ¨äºé¡µé¢ä¸­ï¼Œè¯¥èŠ‚ç‚¹å°†è¢«ç§»åŠ¨åˆ°Rangeå¯¹è±¡ä»£è¡¨çš„åŒºåŸŸçš„èµ·ç‚¹å¤„(insertNode)ã€‚</p>
<p>Rangeå¯¹è±¡APIå®˜ç½‘ï¼š</p>
<p><a href="https://link.juejin.cn/?target=https://developer.mozilla.org/en-US/docs/Web/API/Range%EF%BC%9B">developer.mozilla.org/en-US/docs/â€¦</a></p>
<p>Rangeçš„ä½¿ç”¨åšå®¢ï¼š</p>
<p><a href="https://link.juejin.cn/?target=https://laixiazheteng.com/article/page/id/uMXiMenCofsB">laixiazheteng.com/article/pagâ€¦</a></p>
<p><a href="https://link.juejin.cn/?target=https://blog.csdn.net/qq_21119773/article/details/51627382">blog.csdn.net/qq_21119773â€¦</a></p>

    </div>

    
    
    
      
<div>
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------æœ¬æ–‡ç»“æŸ<i class="fa fa-paw"></i>æ„Ÿè°¢æ‚¨çš„é˜…è¯»-------------</div>
</div>
        

  <div class="followme">
    <p>æ¬¢è¿å…³æ³¨æˆ‘çš„å…¶å®ƒå‘å¸ƒæ¸ é“</p>

    <div class="social-list">

        <div class="social-item">
          <a target="_blank" class="social-link" href="/atom.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>

            <span class="label">RSS</span>
          </a>
        </div>
    </div>
  </div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/React/" rel="tag"><i class="fa fa-tag"></i> React</a>
              <a href="/tags/%E5%89%8D%E7%AB%AF/" rel="tag"><i class="fa fa-tag"></i> å‰ç«¯</a>
              <a href="/tags/%E8%BD%AE%E5%AD%90/" rel="tag"><i class="fa fa-tag"></i> è½®å­</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/02/07/%E8%A5%BF%E6%B9%96%E8%B5%8F%E9%9B%AA%E2%80%94%E2%80%94%E5%A4%B1%E8%B4%A5%E5%AD%A6%E9%9A%8F%E6%83%B3/" rel="prev" title="è¥¿æ¹–èµé›ªâ€”â€”å¤±è´¥å­¦éšæƒ³">
      <i class="fa fa-chevron-left"></i> è¥¿æ¹–èµé›ªâ€”â€”å¤±è´¥å­¦éšæƒ³
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/04/12/%E7%BA%A2%E5%B1%B1%E5%8A%A8%E7%89%A9%E5%9B%AD%E4%B8%80%E6%97%A5%E6%B8%B8%E9%9A%8F%E6%83%B3/" rel="next" title="çº¢å±±åŠ¨ç‰©å›­ä¸€æ—¥æ¸¸éšæƒ³">
      çº¢å±±åŠ¨ç‰©å›­ä¸€æ—¥æ¸¸éšæƒ³ <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#React%E6%A1%86%E6%9E%B6%E8%83%8C%E5%90%8E%E7%9A%84%E6%A0%B8%E5%BF%83%E6%9C%BA%E7%90%86"><span class="nav-text">Reactæ¡†æ¶èƒŒåçš„æ ¸å¿ƒæœºç†</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E9%A1%B9%E7%9B%AE%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="nav-text">1. é¡¹ç›®åˆå§‹åŒ–</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E9%85%8D%E7%BD%AEwebpack%E7%8E%AF%E5%A2%83"><span class="nav-text">2. é…ç½®webpackç¯å¢ƒ</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%AE%89%E8%A3%85webpack"><span class="nav-text">1.å®‰è£…webpack</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E9%85%8D%E7%BD%AEwebpack"><span class="nav-text">2.é…ç½®webpack</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E9%85%8D%E7%BD%AEbabel"><span class="nav-text">3.é…ç½®babel</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E5%AE%9E%E7%8E%B0toyReact"><span class="nav-text">3. å®ç°toyReact</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-%E6%99%AE%E9%80%9A%E8%8A%82%E7%82%B9%E7%9A%84wrapper%E5%AE%9E%E7%8E%B0"><span class="nav-text">3.1 æ™®é€šèŠ‚ç‚¹çš„wrapperå®ç°</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-%E5%AE%9E%E7%8E%B0Component%E7%B1%BB"><span class="nav-text">3.2 å®ç°Componentç±»</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-%E5%AE%9E%E7%8E%B0render"><span class="nav-text">3.3 å®ç°render</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-%E9%87%8D%E6%9E%84createElement"><span class="nav-text">3.4 é‡æ„createElement</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-5-main-js%E6%96%87%E4%BB%B6"><span class="nav-text">3.5 main.jsæ–‡ä»¶</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E4%B8%80%E4%BA%9B%E7%AC%94%E8%AE%B0"><span class="nav-text">4. ä¸€äº›ç¬”è®°</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%BAtoy-react%E6%B7%BB%E5%8A%A0%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="nav-text">ä¸ºtoy-reactæ·»åŠ ç”Ÿå‘½å‘¨æœŸ</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-state%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="nav-text">1. stateçš„å®ç°</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-ToyReact-dom%E6%9B%B4%E6%96%B0"><span class="nav-text">2. ToyReact domæ›´æ–°</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#range%E7%9A%84%E5%AE%9A%E4%B9%89%E5%92%8C-API%E7%9A%84%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8"><span class="nav-text">rangeçš„å®šä¹‰å’Œ APIçš„ç®€å•ä½¿ç”¨</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-%E9%87%8D%E5%86%99Component%E7%9A%84get-root"><span class="nav-text">2.1 é‡å†™Componentçš„get root</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-%E9%87%8D%E5%86%99TextWrapper%E5%92%8CElementWrapper"><span class="nav-text">2.2 é‡å†™TextWrapperå’ŒElementWrapper</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-%E6%9B%B4%E6%96%B0render%E5%87%BD%E6%95%B0"><span class="nav-text">2.3 æ›´æ–°renderå‡½æ•°</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-%E6%94%AF%E6%8C%81%E9%87%8D%E6%96%B0%E7%BB%98%E5%88%B6dom"><span class="nav-text">2.4 æ”¯æŒé‡æ–°ç»˜åˆ¶dom</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-5-%E6%94%AF%E6%8C%81%E8%87%AA%E5%AE%9A%E4%B9%89%E4%BA%8B%E4%BB%B6%E4%BA%8B%E4%BB%B6%E7%BB%91%E5%AE%9A"><span class="nav-text">2.5 æ”¯æŒè‡ªå®šä¹‰äº‹ä»¶äº‹ä»¶ç»‘å®š</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E5%AE%9E%E7%8E%B0setState"><span class="nav-text">3. å®ç°setState</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E9%9B%86%E6%88%90React%E5%AE%98%E7%BD%91%E7%A4%BA%E4%BE%8BTicTacToe-demo"><span class="nav-text">4. é›†æˆReactå®˜ç½‘ç¤ºä¾‹TicTacToe demo</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-insertChildren%E6%94%AF%E6%8C%81child%E4%B8%BAnull"><span class="nav-text">4.1 insertChildrenæ”¯æŒchildä¸ºnull</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-className%E7%9A%84%E7%BB%91%E5%AE%9A"><span class="nav-text">4.2 classNameçš„ç»‘å®š</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-%E4%BF%AE%E5%A4%8D%E7%94%B1%E4%BA%8Erange%E8%A2%AB%E5%90%9E%E5%AF%BC%E8%87%B4%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-text">4.3 ä¿®å¤ç”±äºrangeè¢«åå¯¼è‡´çš„é—®é¢˜</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%99%9A%E6%8B%9FDOM%E7%9A%84%E5%8E%9F%E7%90%86%E5%92%8C%E5%85%B3%E9%94%AE%E5%AE%9E%E7%8E%B0"><span class="nav-text">è™šæ‹ŸDOMçš„åŸç†å’Œå…³é”®å®ç°</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E5%AE%9E%E7%8E%B0%E8%99%9A%E6%8B%9Fdom%E6%A0%91%E7%9A%84%E5%88%9B%E5%BB%BA%E5%8F%8A%E6%B8%B2%E6%9F%93"><span class="nav-text">1. å®ç°è™šæ‹Ÿdomæ ‘çš„åˆ›å»ºåŠæ¸²æŸ“</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E8%99%9A%E6%8B%9FDOM"><span class="nav-text">ä»€ä¹ˆæ˜¯è™šæ‹ŸDOM</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-ElementWrapper%E7%9A%84vdom%E5%AE%9E%E7%8E%B0"><span class="nav-text">1.1 ElementWrapperçš„vdomå®ç°</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-TextWrapper%E7%9A%84vdom%E5%AE%9E%E7%8E%B0"><span class="nav-text">1.2 TextWrapperçš„vdomå®ç°</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-Component%E7%9A%84vdom%E5%AE%9E%E7%8E%B0"><span class="nav-text">1.3 Componentçš„vdomå®ç°</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-4-vdom%E5%88%B0%E5%AE%9E%E4%BD%93dom%E7%9A%84patch"><span class="nav-text">1.4 vdomåˆ°å®ä½“domçš„patch</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-4-1-RENDER-TO-DOM-%E6%96%B9%E6%B3%95%E4%B8%ADpatch%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="nav-text">1.4.1  [RENDER_TO_DOM]æ–¹æ³•ä¸­patchçš„å®ç°</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-5-%E4%BF%AE%E5%A4%8Dbug"><span class="nav-text">1.5 ä¿®å¤bug</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-vdom%E6%AF%94%E5%AF%B9%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="nav-text">2. vdomæ¯”å¯¹çš„å®ç°</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFDiff%E7%AE%97%E6%B3%95"><span class="nav-text">ä»€ä¹ˆæ˜¯Diffç®—æ³•</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-vdom%E6%9B%B4%E6%96%B0"><span class="nav-text">2.1 vdomæ›´æ–°</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-%E7%AE%80%E5%8D%95%E7%9A%84-dom-diff-%E7%AE%97%E6%B3%95"><span class="nav-text">2.2 ç®€å•çš„ dom diff ç®—æ³•</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-newNode%E6%9B%B4%E6%96%B0"><span class="nav-text">2.3 newNodeæ›´æ–°</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-text">æ€»ç»“</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-JSX-%E8%AF%AD%E6%B3%95%E8%A7%A3%E6%9E%90"><span class="nav-text">1. JSX è¯­æ³•è§£æ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-ToyReact%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="nav-text">2. ToyReactç”Ÿå‘½å‘¨æœŸ</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#React%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%87%BD%E6%95%B0"><span class="nav-text">Reactç”Ÿå‘½å‘¨æœŸå‡½æ•°</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#React16%E5%BA%9F%E5%BC%83%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="nav-text">React16åºŸå¼ƒç”Ÿå‘½å‘¨æœŸ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#React16%E6%96%B0%E5%A2%9E2%E4%B8%AA%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%EF%BC%9A"><span class="nav-text">React16æ–°å¢2ä¸ªç”Ÿå‘½å‘¨æœŸï¼š</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-ToyReact%E8%99%9A%E6%8B%9FDOM"><span class="nav-text">3. ToyReactè™šæ‹ŸDOM</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Range"><span class="nav-text">Range</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="hxy"
      src="/images/Robben.gif">
  <p class="site-author-name" itemprop="name">hxy</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">77</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">120</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/huxingyi1997" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;huxingyi1997" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:huxingyi1997@zju.edu.cn" title="E-Mail â†’ mailto:huxingyi1997@zju.edu.cn" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-frog"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">hxy</span>
</div>

<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">åšå®¢å…¨ç«™å…±995.8kå­—</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="æ€»è®¿å®¢é‡">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="æ€»è®¿é—®é‡">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : true,
      appId      : 'pQsO3ySbU4VtWN2j1FLA74Ha-gzGzoHsz',
      appKey     : 'QYacMDY2VY7Wazprg1X6FiUv',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : 'zh-cn' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

  
  <!-- åŠ¨æ€èƒŒæ™¯ç‰¹æ•ˆ -->
  <!-- æ¨±èŠ±ç‰¹æ•ˆ -->
    <script async src="/js/src/sakura.js"></script>
    <script async src="/js/src/fairyDustCursor.js"></script>
</body>
</html>
